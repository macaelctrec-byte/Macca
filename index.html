<!doctypehtml><html dir="rtl"lang="ar"><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1"name="viewport"><title>مكة للأدوات الكهربائية بالمقطم | Macca Electric Tools</title><meta content="مكة للأدوات الكهربائية بالمقطم – كل ما تحتاجه من لمبات، كابلات، مفاتيح، دهانات، وأدوات كهربائية منزلية. شحن سريع وخدمة تركيب احترافية."name="description"><meta content="مكة للأدوات الكهربائية, أدوات كهربائية المقطم, محلات كهرباء القاهرة, متجر كهرباء مكة, كابلات وأسلاك, مفاتيح وبرايز, لمبات, دهانات, مستلزمات كهرباء, توريد وتركيب كهرباء"name="keywords"><meta content="مكة للأدوات الكهربائية"name="author"><meta content="#ffcd00"name="theme-color"><meta content="متجر مكة | للإضاءة الحديثة والدهانات"property="og:title"><meta content="اكتشف تشكيلتنا الواסعة من الإضاءة الحديثة، الدهانات، والكابلات. خبرة 20 عامًا في المقطم."property="og:description"><meta content="website"property="og:type"><meta content="https://macca3.shop/"property="og:url"><meta content="https://i.postimg.cc/NfqhM3Th/photo-2025-10-28-14-04-33.jpg"property="og:image"><meta content="summary_large_image"name="twitter:card"><meta content="متجر مكة | للإضاءة الحديثة والدهانات"name="twitter:title"><meta content="خبرة 20 عامًا في الإضاءة الحديثة والدهانات بالمقطم."name="twitter:description"><meta content="https://i.postimg.cc/NfqhM3Th/photo-2025-10-28-14-04-33.jpg"name="twitter:image"><link href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ffcd00' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M13 3L7 12h4l-1 8 7-12h-4z'/></svg>"rel="icon"type="image/svg+xml"><link href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ffcd00' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M13 3L7 12h4l-1 8 7-12h-4z'/></svg>"rel="apple-touch-icon"><script>if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (e.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });</script><script src="https://cdn.tailwindcss.com?plugins=typography"></script><script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script><link href="https://fonts.googleapis.com"rel="preconnect"><link href="https://fonts.gstatic.com"rel="preconnect"crossorigin><link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap"rel="stylesheet"><style>body{font-family:Cairo,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.dark body{background-image:linear-gradient(to bottom,#2f2921,#19171b);background-attachment:fixed}.dark .dark\:bg-\[\#192230\]{background-color:transparent!important}.dark .dark\:bg-\[\#2c2f38\]{background-color:#2f2921!important}.dark .dark\:bg-\[\#2c2f38\]\/90{background-color:rgba(47,41,33,.9)!important}.dark .dark\:bg-\[\#3d474e\]{background-color:#374151!important}.dark .dark\:bg-\[\#2d2d2d\]{background-color:#2d2d2d!important}.sale-ribbon{position:absolute;top:-1px;right:-1px;left:auto;width:75px;height:75px;overflow:hidden;z-index:10}.sale-ribbon span{position:absolute;top:18px;right:-18px;left:auto;width:100px;background:#ef4444;color:#fff;font-size:.75rem;font-weight:700;text-align:center;padding:4px 0;transform:rotate(45deg);box-shadow:0 2px 4px rgba(0,0,0,.2)}.star-rating{@apply text-[#ffcd00];}.card-hover{@apply transition-all duration-300 ease-in-out;}.card-hover:hover{@apply transform -translate-y-1 scale-105 shadow-xl;}.page-section{display:none;animation:fadeIn .5s ease-in-out}.page-section.active{display:block}#user-dropdown-menu{transition:opacity .1s ease-out,transform .1s ease-out;transform-origin:top right}[dir=rtl] #user-dropdown-menu{transform-origin:top left}#user-dropdown-menu[data-state=closed]{opacity:0;transform:translateY(10px) scale(.95);pointer-events:none}#user-dropdown-menu[data-state=open]{opacity:1;transform:translateY(0) scale(1);pointer-events:auto}.nav-link:hover{@apply text-[#ffcd00];}.nav-link::after{@apply content-[''] absolute bottom-0 w-0 h-0.5 bg-[#ffcd00] transition-all duration-300;right:0;left:auto}.nav-link.active{@apply text-[#ffcd00];}.nav-link.active::after{@apply w-full;}.mobile-nav-link.active{@apply bg-[#ffcd00] text-gray-900;}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}:root{color-scheme:dark}::-webkit-scrollbar{width:8px;height:8px}.prose{overflow-wrap:break-word;word-wrap:break-word}.toast-notification{animation:fadeInOut 2s ease-in-out}@keyframes fadeInOut{0%,100%{opacity:0;transform:translateY(20px) translateX(-50%)}25%,75%{opacity:1;transform:translateY(0) translateX(-50%)}}#chat-history{scroll-behavior:smooth}.chat-message{animation:slideInUp .3s ease-out}.user-message{@apply bg-blue-600 text-white self-end chat-message rounded-br-lg;}.loading-dots{@apply flex items-center space-x-1 p-3;}.loading-dot{@apply w-2 h-2 bg-gray-400 rounded-full animate-bounce;}.loading-dot:nth-child(2){animation-delay:.1s}.loading-dot:nth-child(3){animation-delay:.2s}@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}@keyframes slideInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.chat-recommendation-container{@apply flex gap-3 overflow-x-auto p-2 -mr-2 -ml-2;-webkit-mask-image:linear-gradient(to left,#fff 90%,transparent 100%);mask-image:linear-gradient(to left,#fff 90%,transparent 100%)}.chat-product-card img{@apply w-full h-24 object-cover;}.chat-product-card-content{@apply p-2;}.chat-suggestions-container{@apply flex gap-2 flex-wrap justify-start self-start pt-2;animation:slideInUp .3s ease-out}.ai-modal-backdrop[data-state=open] #gemini-help-panel{opacity:1;transform:translateY(0)}.ai-modal-backdrop[data-state=closed] #gemini-help-panel{opacity:0;transform:translateY(24px)}.ai-modal-backdrop[data-state=open]{opacity:1}.ai-modal-backdrop[data-state=closed]{opacity:0}.suggestion-card img{@apply w-full h-32 object-cover;}.suggestion-card-content{@apply p-3;}.dark .whatsapp-fab{background-color:rgba(255,255,255,.1)!important;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.15);box-shadow:0 4px 12px rgba(0,0,0,.4);color:#ffcd00!important}.dark .whatsapp-fab:hover{background-color:rgba(255,255,255,.2)!important;box-shadow:0 6px 16px rgba(0,0,0,.5);color:#ffda33!important}#ai-suggestions-grid .product-card-wrapper:hover{@apply shadow-lg transform-none scale-100;}#ai-suggestions-grid .p-4{@apply p-3;}#ai-suggestions-grid .product-name{@apply text-sm;}#ai-suggestions-grid .star-rating{@apply mb-1 text-xs;}#ai-suggestions-grid .text-lg{@apply text-base;}#ai-suggestions-grid .text-sm{@apply text-xs;}#ai-suggestions-grid .flex-1{@apply text-xs px-3 py-1.5;}#ai-suggestions-grid .add-to-cart-btn{@apply p-1.5;}#ai-suggestions-grid .add-to-cart-btn i{@apply w-4 h-4;}#ai-suggestions-grid .sale-ribbon{@apply w-16 h-16;}#ai-suggestions-grid .sale-ribbon span{@apply w-20 text-xs top-12 right-[-28px] py-0.5;}</style><body class="dark:bg-[#192230] bg-gray-100 dark:text-gray-200 selection:bg-[#ffcd00] selection:text-gray-900 text-gray-800"><div class="flex flex-col min-h-screen"id="app"><header class="w-full sticky backdrop-blur-lg bg-white/90 border-b border-gray-200 dark:bg-[#2c2f38]/90 dark:border-gray-700/50 shadow-md top-0 z-50"><nav class="lg:px-8 px-4 sm:px-6"><div class="flex items-center justify-between h-16"><a class="flex items-center logo-link flex-shrink-0"href="#home"data-page="home"><div class="flex flex-col"><span class="font-bold text-[#ffcd00] leading-tight sm:text-2xl text-xl">متجر مكة</span> <span class="text-gray-500 dark:text-gray-400 text-xs -mt-1">للإضائة الحديثة والدهانات</span></div></a><div class="hidden sm:flex sm:gap-x-6 sm:mr-6"><a class="nav-link"href="#home"data-page="home">الرئيسية </a><a class="nav-link"href="#products"data-page="products">المنتجات </a><a class="nav-link"href="#blog"data-page="blog">المدونة </a><a class="nav-link"href="#contact"data-page="contact">اتصل بنا</a></div><div class="flex items-center gap-2"><a class="rounded-full p-2 dark:hover:bg-gray-700 hover:bg-gray-200 nav-link relative"href="#cart"data-page="cart"title="سلة المشتريات"><i class="h-5 w-5"data-lucide="shopping-cart"></i> <span class="block text-center -mr-1 -mt-1 absolute bg-[#ffcd00] font-bold h-5 hidden right-0 rounded-full text-gray-900 text-xs top-0 w-5"id="cart-count-badge">0</span> </a><button class="items-center gap-2 rounded-full hidden dark:hover:bg-gray-700 hover:bg-gray-200 mr-1 p-2 sm:inline-flex"id="google-login-btn"title="تسجيل الدخول"><svg class="h-5 w-5"fill="currentColor"viewBox="0 0 20 20"xmlns="http://www.w3.org/2000/svg"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-5.5-2.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 12a5.99 5.99 0 00-4.793 2.39A6.483 6.483 0 0010 16.5a6.483 6.483 0 004.793-2.11A5.99 5.99 0 0010 12z"clip-rule="evenodd"fill-rule="evenodd"/></svg></button><div class="items-center relative hidden mr-1"id="user-info"><button class="rounded-full focus:ring-[#ffcd00] focus:outline-none focus:ring-2 focus:ring-offset-2 p-1"id="user-avatar-btn"type="button"><img alt="الصورة الرمزية للمستخدم"class="rounded-full h-8 w-8"src="https://placehold.co/32x32"id="user-avatar"></button><div class="bg-white dark:bg-[#2c2f38] shadow-lg absolute left-0 mt-2 py-1 ring-1 ring-black ring-opacity-5 rounded-md w-48 z-50"id="user-dropdown-menu"data-state="closed"aria-labelledby="user-avatar-btn"aria-orientation="vertical"role="menu"><a class="block text-sm dark:hover:bg-gray-700 hover:bg-gray-100 px-4 py-2 dark:text-gray-200 text-gray-700"href="#admin"data-page="admin"id="dropdown-admin-link"role="menuitem">لوحة التحكم </a><button class="w-full block dark:hover:bg-gray-700 dark:text-red-400 hover:bg-gray-100 px-4 py-2 text-red-600 text-right text-sm"id="google-logout-btn-dropdown"role="menuitem">تسجيل الخروج</button></div></div><div class="flex items-center sm:hidden"><button class="items-center justify-center dark:hover:bg-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-[#ffcd00] focus:ring-inset hover:bg-gray-200 inline-flex p-2 rounded-md text-gray-600"id="mobile-menu-button"type="button"aria-controls="mobile-menu"aria-expanded="false"><span class="sr-only">فتح القائمة الرئيسية</span> <svg class="block h-6 w-6"fill="none"viewBox="0 0 24 24"xmlns="http://www.w3.org/2000/svg"aria-hidden="true"id="mobile-menu-open-icon"stroke="currentColor"><path d="M4 6h16M4 12h16M4 18h16"stroke-linecap="round"stroke-linejoin="round"stroke-width="2"/></svg> <svg class="hidden h-6 w-6"fill="none"viewBox="0 0 24 24"xmlns="http://www.w3.org/2000/svg"aria-hidden="true"id="mobile-menu-close-icon"stroke="currentColor"><path d="M6 18L18 6M6 6l12 12"stroke-linecap="round"stroke-linejoin="round"stroke-width="2"/></svg></button></div></div></div></nav><div class="hidden sm:hidden"id="mobile-menu"><div class="pb-3 pt-2 px-2 space-y-1"><a class="font-medium block dark:hover:bg-gray-800 hover:bg-gray-200 px-3 py-2 rounded-md text-base dark:text-gray-200 mobile-nav-link text-gray-700"href="#home"data-page="home">الرئيسية</a> <a class="font-medium block dark:hover:bg-gray-800 hover:bg-gray-200 px-3 py-2 rounded-md text-base dark:text-gray-200 mobile-nav-link text-gray-700"href="#products"data-page="products">المنتجات</a> <a class="font-medium block dark:hover:bg-gray-800 hover:bg-gray-200 px-3 py-2 rounded-md text-base dark:text-gray-200 mobile-nav-link text-gray-700"href="#blog"data-page="blog">المدونة</a> <a class="font-medium block dark:hover:bg-gray-800 hover:bg-gray-200 px-3 py-2 rounded-md text-base dark:text-gray-200 mobile-nav-link text-gray-700"href="#contact"data-page="contact">اتصل بنا</a> <a class="font-medium block dark:hover:bg-gray-800 hover:bg-gray-200 px-3 py-2 rounded-md text-base dark:text-gray-200 mobile-nav-link text-gray-700"href="#cart"data-page="cart">سلة المشتريات <span class="font-bold text-gray-900 bg-[#ffcd00] hidden rounded-full h-5 text-center text-xs w-5 inline-block mr-2"id="mobile-cart-count-badge">0</span> </a><a class="font-medium block dark:hover:bg-gray-800 hover:bg-gray-200 px-3 py-2 rounded-md text-base dark:text-gray-200 mobile-nav-link text-gray-700"href="#"id="google-login-btn-mobile">تسجيل الدخول بحساب جوجل</a><div class="items-center justify-between hidden px-3 py-2"id="user-info-mobile"><div class="flex items-center gap-2"><img alt="الصورة الرمزية للمستخدم"class="rounded-full h-8 w-8"src="https://placehold.co/32x32"id="user-avatar-mobile"> <span class="font-medium dark:text-gray-200 text-gray-700 text-base"id="user-name-mobile"></span></div><a class="font-medium block dark:hover:bg-gray-800 hover:bg-gray-200 px-3 py-2 rounded-md text-base text-red-500"href="#"id="google-logout-btn-mobile">تسجيل الخروج</a></div></div></div></header><div class="w-full duration-300 ease-in-out h-[100px] sticky top-[64px] transition-transform z-40 bg-[#294e3a] dark:hidden"id="special-offer-banner-light"><a class="block h-full"href="#products"title="عرض خاص"><img alt="عرض خاص - تقسيط 0%"class="w-full object-cover h-full"src="https://i.postimg.cc/rmD00KSG/00000.jpg"onerror='this.src="https://placehold.co/1400x78/294e3a/ffffff?text=Special+Offer+Banner"'></a></div><div class="w-full duration-300 ease-in-out h-[100px] sticky top-[64px] transition-transform z-40 bg-[#1a2b20] dark:block hidden"id="special-offer-banner-dark"><a class="block h-full"href="#products"title="عرض خاص (وضع داكن)"><img alt="عرض خاص - الوضع الداكن"class="w-full object-cover h-full"src="https://i.postimg.cc/rmD00KSG/00000.jpg"></a></div><main class="lg:px-8 px-4 sm:px-6 flex-1 pb-8"><section class="page-section pt-8 space-y-12"id="page-home"><div class="bg-[#2c2f38] overflow-hidden relative rounded-xl shadow-2xl"style="min-height:350px"><video autoplay class="w-full object-cover h-full absolute inset-0 opacity-30"id="hero-video"loop muted playsinline><source id="hero-video-source"src="https://assets.mixkit.co/videos/47669/47669-720.mp4"type="video/mp4">Your browser does not support the video tag.</video><div class="flex flex-col h-full items-start justify-end lg:p-12 p-6 relative sm:p-8 text-right z-10"style="min-height:350px"><h1 class="font-extrabold leading-tight max-w-3xl sm:text-4xl text-2xl text-white">متجر مكة</h1><p class="text-[#ffcd00] text-sm max-w-3xl mt-3 sm:text-base">كل ما هو جديد في عالم الديكور الحديث والإضاءة<p class="mt-3 sm:text-lg text-base text-gray-200">أكثر من 20 عامًا من الخبرة في قلب المقطم</p><a class="items-center gap-3 duration-300 font-bold px-6 py-3 rounded-lg transform transition-all text-gray-900 bg-gradient-to-r from-[#ffcd00] hover:-translate-y-1 hover:from-[#ffda33] hover:shadow-2xl hover:to-[#ffcd00] inline-flex mt-8 nav-link shadow-xl sm:px-8 sm:text-lg text-base to-[#ffb700]"href="#products"data-page="products"><span>تصفح المنتجات</span> <i class="h-5 w-5"data-lucide="arrow-right"></i></a></div></div><div><h2 class="font-bold text-2xl sm:text-3xl text-right mb-6">أقسامنا الرئيسية</h2><div class="grid grid-cols-2 lg:grid-cols-5 gap-4 md:grid-cols-3 sm:gap-6"><a class="block text-center bg-white card-hover dark:bg-[#2c2f38] duration-300 group nav-link p-6 rounded-2xl shadow-lg transition-all"href="#products"data-page="products"data-category-filter="Lighting"><img alt="لمبات وإضاءة"class="rounded-full aspect-square border-4 border-transparent duration-300 group-hover:border-[#ffcd00] group-hover:scale-110 h-20 mx-auto object-cover sm:h-24 sm:w-24 transition-all w-20"src="https://i.postimg.cc/7LYxshZq/51w-Sm-F3x-Kg-L-AC-SY879.jpg"><h3 class="font-semibold dark:text-white sm:text-lg text-base group-hover:text-[#ffcd00] mt-4 text-gray-800 transition-colors">لمبات وإضاءة</h3></a><a class="block text-center bg-white card-hover dark:bg-[#2c2f38] duration-300 group nav-link p-6 rounded-2xl shadow-lg transition-all"href="#products"data-page="products"data-category-filter="Cables"><img alt="كابلات وأسلاك"class="rounded-full aspect-square border-4 border-transparent duration-300 group-hover:border-[#ffcd00] group-hover:scale-110 h-20 mx-auto object-cover sm:h-24 sm:w-24 transition-all w-20"src="https://i.postimg.cc/VNLYGvks/51was-ZSe-Mw-L-AC.jpg"><h3 class="font-semibold dark:text-white sm:text-lg text-base group-hover:text-[#ffcd00] mt-4 text-gray-800 transition-colors">كابلات وأسلاك</h3></a><a class="block text-center bg-white card-hover dark:bg-[#2c2f38] duration-300 group nav-link p-6 rounded-2xl shadow-lg transition-all"href="#products"data-page="products"data-category-filter="Switches"><img alt="مفاتيح وبرايز"class="rounded-full aspect-square border-4 border-transparent duration-300 group-hover:border-[#ffcd00] group-hover:scale-110 h-20 mx-auto object-cover sm:h-24 sm:w-24 transition-all w-20"src="https://i.postimg.cc/d0tqH3VV/bbbbb.jpg"><h3 class="font-semibold dark:text-white sm:text-lg text-base group-hover:text-[#ffcd00] mt-4 text-gray-800 transition-colors">مفاتيح وبرايز</h3></a><a class="block text-center bg-white card-hover dark:bg-[#2c2f38] duration-300 group nav-link p-6 rounded-2xl shadow-lg transition-all"href="#products"data-page="products"data-category-filter="Paints"><img alt="دهانات"class="rounded-full aspect-square border-4 border-transparent duration-300 group-hover:border-[#ffcd00] group-hover:scale-110 h-20 mx-auto object-cover sm:h-24 sm:w-24 transition-all w-20"src="https://i.postimg.cc/HkkKFyXR/464646.jpg"><h3 class="font-semibold dark:text-white sm:text-lg text-base group-hover:text-[#ffcd00] mt-4 text-gray-800 transition-colors">دهانات</h3></a><a class="block text-center bg-white card-hover dark:bg-[#2c2f38] duration-300 group nav-link p-6 rounded-2xl shadow-lg transition-all"href="#products"data-page="products"data-category-filter="Parts"><img alt="قطع غيار كهربائية"class="rounded-full aspect-square border-4 border-transparent duration-300 group-hover:border-[#ffcd00] group-hover:scale-110 h-20 mx-auto object-cover sm:h-24 sm:w-24 transition-all w-20"src="https://i.postimg.cc/8CP1Kcz1/pngtree-tool-electric-equipment-png-image-9135330.png"><h3 class="font-semibold dark:text-white sm:text-lg text-base group-hover:text-[#ffcd00] mt-4 text-gray-800 transition-colors">قطع غيار كهربائية</h3></a></div></div><div><div class="flex items-center justify-between mb-6"><h2 class="font-bold text-2xl sm:text-3xl text-right">العروض الحالية</h2><a class="flex items-center gap-1 font-medium hover:text-[#ffda33] see-all-link text-[#ffcd00] text-sm"href="#products"data-filter-type="sale"><span>عرض الكل</span> <i class="h-4 w-4"data-lucide="arrow-right"></i></a></div><div class="grid grid-cols-2 gap-3 sm:gap-4 sm:grid-cols-3 lg:grid-cols-5 md:grid-cols-4"id="home-offers-grid"></div></div><div><div class="flex items-center justify-between mb-6"><h2 class="font-bold text-2xl sm:text-3xl text-right">الأكثر مبيعاً</h2><a class="flex items-center gap-1 font-medium hover:text-[#ffda33] see-all-link text-[#ffcd00] text-sm"href="#products"data-filter-type="bestseller"><span>عرض الكل</span> <i class="h-4 w-4"data-lucide="arrow-right"></i></a></div><div class="grid grid-cols-2 gap-3 sm:gap-4 sm:grid-cols-3 lg:grid-cols-5 md:grid-cols-4"id="home-bestsellers-grid"></div></div><div class="bg-white dark:bg-[#2c2f38] overflow-hidden rounded-2xl shadow-xl mt-12 p-8 sm:p-12"><div class="items-center gap-8 grid grid-cols-1 md:grid-cols-3 md:text-left text-center"><div class="flex justify-center md:justify-start"><div class="rounded-full dark:bg-[#3d474e] bg-gray-100 p-4 text-[#ffcd00]"><i class="w-16 h-16"data-lucide="clipboard-check"></i></div></div><div class="space-y-3 md:col-span-2"><h2 class="font-bold text-gray-900 dark:text-white text-2xl sm:text-3xl">خدمات التوريد والتركيب الاحترافية</h2><p class="dark:text-gray-300 text-gray-600 text-base leading-relaxed sm:text-lg">لسنا مجرد متجر، بل شركاء لك في النجاح. نقدم خدمات توريد متكاملة للمشاريع والشركات، مع فريق فني متخصص للتركيب يضمن لك أعلى معايير الجودة والأمان.</p><a class="items-center gap-2 rounded-lg font-bold py-3 bg-[#ffcd00] hover:bg-[#ffda33] shadow-lg text-gray-900 inline-flex nav-link px-6 duration-300 hover:-translate-y-0.5 mt-4 transform transition-all"href="#contact"data-page="contact"><span>اطلب خدمتك الآن</span> <i class="h-5 w-5"data-lucide="arrow-right"></i></a></div></div></div></section><section class="page-section pt-8"id="page-products"><h1 class="font-bold text-3xl sm:text-4xl mb-8">جميع المنتجات</h1><div class="flex items-center gap-4 flex-col sm:flex-row mb-8"><div class="flex items-center overflow-hidden rounded-full bg-white border border-gray-200 dark:bg-[#2d2d2d] dark:border-gray-700 flex-grow shadow-lg w-full"><div class="relative"><i class="h-4 w-4 -translate-y-1/2 absolute pointer-events-none text-gray-400 top-1/2 z-10 left-3"data-lucide="chevron-down"></i> <select class="font-medium text-sm text-gray-700 appearance-none dark:text-gray-200 focus:border-transparent focus:ring-0 px-4 py-3 rounded-full bg-gray-50 border-none dark:bg-[#3d474e] focus:z-10 pl-10 pr-4 w-auto"id="product-category-filter"><option value="all">جميع الأقسام<option value="Lighting">إضاءة<option value="Cables">كابلات<option value="Switches">مفاتيح<option value="Paints">دهانات<option value="Parts">قطع غيار</select></div><div class="relative flex-grow"><input class="w-full py-3 px-4 focus:border-transparent focus:ring-0 pl-4 pr-10 bg-transparent border-none dark:text-white focus:z-10 placeholder:text-gray-400 text-gray-900"id="product-search-input"placeholder="ابحث في جميع الأقسام..."> <span class="-translate-y-1/2 absolute top-1/2 left-auto right-4 text-gray-400"><i class="h-5 w-5"data-lucide="search"></i></span></div></div><div class="w-full relative sm:w-auto"><i class="h-4 w-4 -translate-y-1/2 absolute pointer-events-none text-gray-400 top-1/2 z-10 left-auto right-4"data-lucide="chevron-down"></i> <select class="w-full py-3 px-4 border rounded-full appearance-none bg-white border-gray-200 dark:bg-[#2d2d2d] dark:border-gray-700 dark:text-gray-200 focus:border-transparent focus:ring-0 font-medium pl-4 pr-10 shadow-lg sm:w-auto text-gray-700 text-sm"id="product-sort-filter"><option value="default">الترتيب حسب<option value="price-asc">السعر: من الأقل للأعلى<option value="price-desc">السعر: من الأعلى للأقل</select></div><button class="items-center gap-2 font-bold py-3 bg-[#ffcd00] hover:bg-[#ffda33] shadow-lg text-gray-900 flex-shrink-0 hidden justify-center px-4 sm:justify-start text-sm rounded-full"id="show-add-product-modal-btn"type="button"><i class="h-4 w-4"data-lucide="plus-circle"></i> <span>إضافة منتج</span></button></div><div class="grid grid-cols-2 gap-3 sm:gap-4 sm:grid-cols-3 lg:grid-cols-5 md:grid-cols-4 xl:grid-cols-6"id="products-grid"></div><div class="hidden text-center py-12"id="no-products-message"><i class="mx-auto h-16 text-gray-400 w-16"data-lucide="search-x"></i><h2 class="font-semibold text-2xl mt-4">لم يتم العثور على منتجات</h2><p class="text-gray-500 dark:text-gray-400 mt-2">حاول تعديل البحث أو الفلترة.</div></section><section class="page-section"id="page-details"><div class="mb-6"><a class="items-center gap-2 rounded-lg bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-200 font-medium hover:bg-gray-300 px-4 py-2 text-gray-800 inline-flex nav-link shadow-sm transition-colors"href="#products"data-page="products"><i class="h-5 w-5"data-lucide="arrow-right"></i> <span>العودة للمنتجات</span></a></div><div class="grid grid-cols-1 gap-8 lg:gap-12 max-w-7xl md:grid-cols-5 mx-auto"><div class="md:col-span-3"><div class="bg-white dark:bg-[#2c2f38] p-6 rounded-2xl shadow-xl sm:p-8 overflow-hidden"><div class="flex flex-col-reverse gap-4 md:flex-row-reverse"><div class="relative group flex-1"><img alt="صورة المنتج الرئيسية"class="w-full rounded-lg shadow-md object-cover aspect-square h-auto"src="https://placehold.co/600x600/ffffff/999999?text=Main+Product+Image"onerror='this.src="https://placehold.co/600x600/ffffff/999999?text=صورة+المنتج+الرئيسية"'id="main-product-image"> <button class="rounded-full p-2 -translate-y-1/2 absolute bg-black/30 group-hover:opacity-100 hover:bg-black/50 opacity-0 text-white top-1/2 transition-opacity z-10 left-auto right-2"id="gallery-prev-btn"><i class="h-6 w-6"data-lucide="chevron-left"></i></button> <button class="rounded-full p-2 -translate-y-1/2 absolute bg-black/30 group-hover:opacity-100 hover:bg-black/50 opacity-0 text-white top-1/2 transition-opacity z-10 left-2 right-auto"id="gallery-next-btn"><i class="h-6 w-6"data-lucide="chevron-right"></i></button></div><div class="flex md:flex-col flex-shrink-0 gap-2 md:max-h-[600px] md:overflow-y-auto md:w-20 overflow-x-auto w-full"id="details-thumbnail-container"></div></div><div class="hidden md:block mt-12"><h3 class="font-bold text-gray-900 dark:text-white text-2xl mb-6">قد يعجبك أيضاً</h3><div class="hidden justify-center loading-dots py-8"id="ai-suggestions-loading-desktop"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div><div class="grid grid-cols-2 gap-3 sm:gap-4 sm:grid-cols-3"id="ai-suggestions-grid-desktop"></div></div></div></div><div class="flex flex-col gap-6 md:col-span-2"><div class="bg-white dark:bg-[#2c2f38] p-6 rounded-2xl shadow-xl sm:p-8"><span class="font-medium block mb-1 dark:text-gray-400 hidden text-gray-500 text-lg"id="details-product-company"></span><h1 class="text-3xl mb-4 dark:text-white font-extrabold lg:text-4xl text-gray-900"id="details-product-name">جاري التحميل...</h1><div class="star-rating mb-4 text-xl"id="details-star-rating"></div><div class="mb-6"id="details-product-price"></div><p class="dark:text-gray-300 text-gray-600 leading-relaxed break-words mb-8"id="details-product-description">جاري تحميل الوصف...<div class="space-y-4 product-card-wrapper"id="details-add-to-cart-wrapper"data-product-id=""data-product-image=""data-product-name=""data-product-price=""><div class="flex items-end gap-3"><div><label class="font-medium block mb-1 text-sm dark:text-gray-300 text-gray-700"for="details-quantity-input">الكمية</label> <input class="font-bold rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4 text-center text-lg w-24"id="details-quantity-input"type="number"min="1"value="1"></div><button class="flex items-center justify-center rounded-lg flex-1 add-to-cart-btn bg-[#ffcd00] duration-300 font-bold gap-3 hover:-translate-y-0.5 hover:bg-[#ffda33] px-6 py-3 shadow-lg text-gray-900 text-lg transform transition-all"><i class="h-6 w-6"data-lucide="shopping-cart"></i> <span>إضافة للسلة</span></button></div><a class="flex items-center justify-center rounded-lg font-bold px-6 py-3 duration-300 gap-3 shadow-lg text-lg transform transition-all bg-transparent border border-green-500 hover:bg-green-500 hover:text-white text-green-500 w-full"href="https://wa.me/201146641942"id="details-whatsapp-link"target="_blank"><i class="h-6 w-6"data-lucide="message-circle"></i> <span>تواصل عبر واتساب</span></a></div></div><div class="bg-white dark:bg-[#2c2f38] overflow-hidden rounded-2xl shadow-xl"><div class="flex border-b border-gray-200 dark:border-gray-700"><button class="font-semibold text-lg px-6 py-4 tab-btn active-tab border-[#ffcd00] border-b-2 text-[#ffcd00]"data-tab="specs">المواصفات</button> <button class="font-semibold text-lg px-6 py-4 tab-btn dark:hover:text-white hover:text-gray-900 text-gray-500"data-tab="reviews">المراجعات (3)</button></div><div class="sm:p-8 p-6"><div class="space-y-3 tab-content"id="tab-content-specs"><h3 class="font-semibold dark:text-white text-gray-900 mb-4 text-xl">تفاصيل المنتج</h3><ul class="dark:text-gray-300 text-gray-600 text-base max-w-md space-y-3"id="specs-list-container"></ul></div><div class="hidden space-y-6 tab-content"id="tab-content-reviews"><h3 class="font-semibold dark:text-white text-gray-900 mb-4 text-xl">مراجعات العملاء</h3><div class="space-y-6"><div class="pb-6 border-b border-gray-200 dark:border-gray-700"><div class="flex items-center mb-2"><span class="font-semibold dark:text-white text-gray-900 text-lg">أحمد محمود</span> <span class="text-gray-500 text-sm mr-3">منذ أسبوع</span></div><div class="text-[#ffcd00] text-xl mb-2">★★★★☆</div><p class="dark:text-gray-300 text-gray-600 text-base mt-1">منتج ممتاز وجودة عالية، لكن التوصيل تأخر قليلاً.</div><div class="pb-6 border-b border-gray-200 dark:border-gray-700"><div class="flex items-center mb-2"><span class="font-semibold dark:text-white text-gray-900 text-lg">فاطمة علي</span> <span class="text-gray-500 text-sm mr-3">منذ شهر</span></div><div class="text-[#ffcd00] text-xl mb-2">★★★★★</div><p class="dark:text-gray-300 text-gray-600 text-base mt-1">رائع! أنصح به بشدة.</div></div></div></div></div></div></section><div class="mt-12 md:hidden"><div class="bg-white dark:bg-[#2c2f38] p-6 rounded-2xl shadow-xl sm:p-8 overflow-hidden"><h3 class="font-bold text-gray-900 dark:text-white text-2xl mb-6">قد يعجبك أيضاً</h3><div class="hidden justify-center loading-dots py-8"id="ai-suggestions-loading-mobile"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div><div class="grid grid-cols-2 gap-3 sm:gap-4 sm:grid-cols-3"id="ai-suggestions-grid-mobile"></div></div></div><section class="page-section pt-8 space-y-12"id="page-about"><div class="bg-white dark:bg-[#2c2f38] shadow-lg rounded-xl text-center md:p-12 overflow-hidden p-8 relative"><h1 class="font-bold mb-4 text-4xl text-[#ffcd00]">عن متجر مكة</h1><p class="dark:text-gray-300 text-gray-600 mx-auto text-xl max-w-3xl">خبرة تمتد لأكثر من 20 عامًا في قلب المقطم، نقدم كل ما هو جديد في عالم الديكور الحديث والإضاءة.</div><div class="grid grid-cols-1 gap-6 md:grid-cols-3"><div class="flex items-center p-6 gap-4 bg-white dark:bg-[#2c2f38] rounded-xl shadow-lg"><i class="text-[#ffcd00] flex-shrink-0 h-10 w-10"data-lucide="award"></i><div><h3 class="font-semibold text-lg">خبرة موثوقة</h3><p class="text-gray-500 dark:text-gray-400 text-sm">أكثر من 20 عامًا في السوق.</div></div><div class="flex items-center p-6 gap-4 bg-white dark:bg-[#2c2f38] rounded-xl shadow-lg"><i class="text-[#ffcd00] flex-shrink-0 h-10 w-10"data-lucide="shield-check"></i><div><h3 class="font-semibold text-lg">جودة مضمونة</h3><p class="text-gray-500 dark:text-gray-400 text-sm">أفضل الماركات المضمونة.</div></div><div class="flex items-center p-6 gap-4 bg-white dark:bg-[#2c2f38] rounded-xl shadow-lg"><i class="text-[#ffcd00] flex-shrink-0 h-10 w-10"data-lucide="truck"></i><div><h3 class="font-semibold text-lg">توريد وتركيب</h3><p class="text-gray-500 dark:text-gray-400 text-sm">خدمات احترافية للمشاريع.</div></div></div><div class="bg-white dark:bg-[#2c2f38] p-6 shadow-lg rounded-xl sm:p-8"><div class="items-center gap-8 grid grid-cols-1 lg:grid-cols-2"><div class="space-y-4"><h2 class="font-bold text-3xl mb-4">قصتنا</h2><p class="dark:text-gray-300 text-gray-600 text-base leading-relaxed sm:text-lg">"متجر مكة للأدوات الكهربائية هو وجهتك الأولى لكل احتياجاتك الكهربائية، نقدم لك منتجات عالية الجودة بأسعار منافسة. بخبرتنا الممتدة لسنوات في المجال، نوفر لك أفضل الأدوات والماركات المضمونة، لأن الثقة بالنسبة لنا ليست خيارًا، بل هي أساس عملنا."<p class="dark:text-gray-300 text-gray-600 text-base leading-relaxed sm:text-lg">نحن لا نبيع منتجات فحسب، بل نقدم حلولاً متكاملة تشمل التوريد والتركيب للمشاريع السكنية والتجارية، بفريق فني متخصص يضمن لك الأمان والجودة.</div><div><h2 class="font-bold text-3xl mb-4 lg:hidden">صور من المتجر</h2><div class="grid grid-cols-2 gap-4"><img alt="المتجر من الداخل 1"class="w-full rounded-lg shadow-md object-cover h-48"src="https://i.postimg.cc/NfqhM3Th/photo-2025-10-28-14-04-33.jpg"onerror='this.src="https://placehold.co/600x400/555555/ffffff?text=المتجر+من+الداخل+1"'> <img alt="المتجر من الداخل 2"class="w-full rounded-lg shadow-md object-cover h-48"src="https://i.postimg.cc/bNjM8Qck/photo-2025-10-28-14-05-51.jpg"onerror='this.src="https://placehold.co/600x400/555555/ffffff?text=المتجر+من+الداخل+2"'> <img alt="فريق العمل"class="w-full rounded-lg shadow-md object-cover h-48 col-span-2"src="https://wl-img-prd.s3-accelerate.amazonaws.com/940aa6b6-b49b-492b-8b88-a6680cb25b6c-h.jpeg"onerror='this.src="https://placehold.co/600x400/555555/ffffff?text=فريق+العمل"'></div></div></div></div></section><section class="page-section pt-8"id="page-blog"><div class="flex items-center justify-between mb-8"><h1 class="font-bold text-3xl sm:text-4xl text-center sm:text-right">مدونة ونصائح كهربائية</h1><button class="items-center gap-2 rounded-lg font-bold py-3 bg-[#ffcd00] hover:bg-[#ffda33] shadow-lg text-gray-900 flex-shrink-0 hidden justify-center px-4 sm:justify-start text-sm"id="show-add-article-modal-btn"type="button"><i class="h-4 w-4"data-lucide="plus-circle"></i> <span>إضافة مقالة</span></button></div><div class="grid grid-cols-1 gap-6 md:grid-cols-3"id="blog-grid"><div class="bg-white dark:bg-[#2c2f38] shadow-lg rounded-xl overflow-hidden card-hover"><div class="animate-pulse p-4"><div class="w-full bg-gray-200 dark:bg-gray-700 rounded-md h-40"></div><div class="h-5 bg-gray-200 dark:bg-gray-700 mt-3 rounded-md w-3/4"></div><div class="w-full bg-gray-200 dark:bg-gray-700 rounded-md h-4 mt-4"></div><div class="h-4 bg-gray-200 dark:bg-gray-700 mt-4 rounded-md w-1/4"></div></div></div></div></section><section class="page-section pt-8 space-y-12"id="page-contact"><h1 class="font-bold text-3xl sm:text-4xl text-center mb-4">تواصل معنا</h1><p class="dark:text-gray-300 text-gray-600 mx-auto text-xl max-w-2xl text-center">نحن هنا لمساعدتك. سواء كان لديك سؤال عن منتج، أو تحتاج خدمة تركيب، فريقنا جاهز للرد.<div class="grid grid-cols-1 gap-6 md:grid-cols-3"><div class="bg-white dark:bg-[#2c2f38] p-6 shadow-lg rounded-xl duration-300 hover:-translate-y-1 text-center transform transition-all"><i class="text-[#ffcd00] mb-4 h-12 mx-auto w-12"data-lucide="map-pin"></i><h3 class="font-semibold text-xl mb-2">عنواننا</h3><p class="dark:text-gray-300 text-gray-600">المقطم، شارع المدينة المنورة، متفرع من شارع 9، أمام مدرسة الراعي الصالح، قطعة 7987.</div><div class="bg-white dark:bg-[#2c2f38] p-6 shadow-lg rounded-xl duration-300 hover:-translate-y-1 text-center transform transition-all"><i class="text-[#ffcd00] mb-4 h-12 mx-auto w-12"data-lucide="phone"></i><h3 class="font-semibold text-xl mb-2">اتصل بنا</h3><div class="dark:text-gray-300 text-gray-600"dir="ltr"><a class="block hover:text-[#ffda33] transition-colors"href="tel:0225071272">0225071272 (هاتف المتجر)</a> <a class="block hover:text-[#ffda33] transition-colors"href="https://wa.me/201146641942">01146641942 (واتساب)</a></div></div><div class="bg-white dark:bg-[#2c2f38] p-6 shadow-lg rounded-xl duration-300 hover:-translate-y-1 text-center transform transition-all"><i class="text-[#ffcd00] mb-4 h-12 mx-auto w-12"data-lucide="clock"></i><h3 class="font-semibold text-xl mb-2">ساعات العمل</h3><p class="dark:text-gray-300 text-gray-600">السبت - الخميس<br>9:00 صباحاً - 11:00 مساءً</div></div><div class="bg-white dark:bg-[#2c2f38] p-6 shadow-lg rounded-xl sm:p-8 mx-auto max-w-6xl"><div class="grid grid-cols-1 md:grid-cols-2 gap-12"><form class="space-y-6"id="contact-form"><h3 class="font-semibold text-2xl mb-3">أرسل لنا رسالة</h3><div><label class="font-medium block mb-1 text-sm"for="name">الاسم</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="name"placeholder="اسمك بالكامل"name="name"required></div><div><label class="font-medium block mb-1 text-sm"for="phone">رقم الهاتف</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="phone"type="tel"placeholder="01xxxxxxxxx"name="phone"required></div><div><label class="font-medium block mb-1 text-sm"for="message">الرسالة</label> <textarea class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="message"rows="5"placeholder="كيف يمكننا مساعدتك؟"name="message"required></textarea></div><button class="w-full rounded-lg py-3 font-bold px-6 shadow-md transition-colors bg-[#ffcd00] hover:bg-[#ffda33] text-gray-900"type="submit">إرسال الرسالة</button><div class="font-medium hidden text-center text-green-500"id="form-success-message">تم إرسال رسالتك بنجاح!</div></form><div class="space-y-6"><h3 class="font-semibold text-2xl mb-3">موقعنا على الخريطة</h3><div class="aspect-h-9 aspect-w-16 h-full min-h-[400px] overflow-hidden rounded-lg shadow-md"><iframe allowfullscreen height="100%"loading="lazy"referrerpolicy="no-referrer-when-downgrade"src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d55276.0159441113!2d31.27210741164801!3d30.00350917260086!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1458380b09995129%3A0x6a05d34f0c476f0!2sMokattam%2C%2C%20Cairo%20Governorate%2C%20Egypt!5e0!3m2!1sen!2sus!4v1678886500000!5m2!1sen!2sus"style="border:0"width="100%"></iframe></div></div></div></div></section><section class="page-section pt-8"id="page-blog-post"><div class="bg-white dark:bg-[#2c2f38] p-6 shadow-lg rounded-xl mx-auto max-w-4xl sm:p-10"><a class="font-medium hover:text-[#ffda33] text-[#ffcd00] inline-block mb-6 nav-link"href="#blog"data-page="blog">← العودة للمدونة</a><h1 class="font-bold text-3xl sm:text-4xl mb-6"id="blog-post-title">جاري التحميل...</h1><img alt="صورة المقالة"class="w-full rounded-lg shadow-md object-cover h-64 mb-8"src="https://placehold.co/800x400/eeeeee/777777?text=جاري+تحميل+الصورة"onerror='this.src="https://placehold.co/800x400/eeeeee/777777?text=Image+Not+Found"'id="blog-post-image"><div class="dark:text-gray-300 leading-relaxed dark:prose-invert max-w-none prose prose-lg space-y-4 text-gray-700"id="blog-post-content-wrapper"><p>جاري تحميل المحتوى...</div></div></section><section class="hidden page-section"id="page-blog-2"></section><section class="hidden page-section"id="page-blog-3"></section><section class="hidden page-section"id="page-blog-4"></section><section class="page-section pt-8"id="page-cart"><div class="flex items-center gap-3 mb-8"><i class="text-[#ffcd00] h-8 sm:h-10 sm:w-10 w-8"data-lucide="shopping-cart"></i><h1 class="font-bold text-3xl sm:text-4xl">سلة مشترياتك</h1></div><div class="bg-white dark:bg-[#2c2f38] p-6 shadow-lg rounded-xl sm:p-8"><div class="space-y-6"id="cart-items-container"></div><div class="hidden text-center py-12"id="cart-empty-message"><i class="mx-auto h-16 text-gray-400 w-16"data-lucide="shopping-cart"></i><h2 class="font-semibold text-2xl mt-4">سلّتك فارغة</h2><p class="text-gray-500 dark:text-gray-400 mt-2">يبدو أنك لم تقم بإضافة أي منتجات لسلتك بعد.</p><a class="items-center gap-2 rounded-lg font-bold py-3 bg-[#ffcd00] hover:bg-[#ffda33] shadow-lg text-gray-900 inline-flex nav-link px-6 mt-6"href="#products"data-page="products"><i class="h-5 w-5"data-lucide="arrow-left"></i> <span>ابدأ التسوق</span></a></div><div class="hidden border-gray-200 border-t dark:border-gray-700 mt-8 pt-6"id="cart-summary"><div class="flex justify-end"><div class="w-full md:w-1/3"><div class="flex justify-between font-medium text-lg"><span>المجموع الفرعي:</span> <span id="cart-subtotal">0.00 EGP</span></div><div class="flex justify-between dark:text-gray-400 mt-2 text-gray-500 text-sm"><span>الشحن:</span> <span>يُحسب عند الدفع</span></div><div class="flex justify-between font-bold mt-4 text-2xl"><span>الإجمالي:</span> <span id="cart-total">0.00 EGP</span></div><button class="flex items-center justify-center rounded-lg font-bold px-6 py-3 w-full bg-green-500 gap-2 hover:bg-green-400 mt-6 shadow-md text-white transition-colors"id="whatsapp-checkout-btn"><i class="h-5 w-5"data-lucide="check-circle"></i> <span>إتمام الطلب (عبر واتساب)</span></button></div></div></div></div></section><section class="page-section pt-8"id="page-admin"><h1 class="font-bold text-3xl sm:text-4xl mb-8">لوحة التحكم</h1><div class="bg-white dark:bg-[#2c2f38] p-6 shadow-lg rounded-xl sm:p-8 mx-auto max-w-2xl"><form class="space-y-6"id="admin-settings-form"><h2 class="font-semibold text-2xl mb-4">إعدادات البانر العلوي</h2><div><label class="font-medium block mb-1 text-sm"for="admin-light-banner-url">رابط صورة البانر (الوضع الفاتح)</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="admin-light-banner-url"type="url"placeholder="https://example.com/light-banner.jpg"></div><div><label class="font-medium block mb-1 text-sm"for="admin-dark-banner-url">رابط صورة البانر (الوضع الداكن)</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="admin-dark-banner-url"type="url"placeholder="https://example.com/dark-banner.jpg"></div><hr class="border-gray-200 dark:border-gray-700"><h2 class="font-semibold text-2xl mb-4">إعدادات الصفحة الرئيسية</h2><div><label class="font-medium block mb-1 text-sm"for="admin-video-url">رابط فيديو الهيرو (الصفحة الرئيسية)</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="admin-video-url"type="url"placeholder="https://example.com/video.mp4"></div><button class="w-full rounded-lg py-3 font-bold px-6 shadow-md transition-colors bg-[#ffcd00] hover:bg-[#ffda33] text-gray-900"id="save-admin-settings-btn"type="submit">حفظ الإعدادات</button></form></div></section></main><footer class="bg-white dark:bg-[#2c2f38] mt-12 border-gray-200 border-t dark:border-gray-700"><div class="lg:px-8 px-4 sm:px-6 py-8"><div class="flex justify-between flex-col gap-10 lg:flex-row"><div class="lg:text-right lg:w-2/5 text-center"><a class="nav-link inline-block"href="#home"data-page="home"><span class="font-bold text-2xl sm:text-3xl text-[#ffcd00]">متجر مكة</span></a><p class="dark:text-gray-300 text-gray-600 mx-auto lg:mx-0 max-w-sm mt-4 text-sm">متجر مكة: كل ما هو جديد في عالم الديكور الحديث والإضاءة. أكثر من 20 عامًا من الخبرة.</div><div class="grid grid-cols-1 gap-8 lg:w-3/5 sm:grid-cols-2"><div class="sm:text-right text-center"><h3 class="font-semibold dark:text-white sm:text-lg text-base mb-4 text-gray-900">معلومات</h3><ul class="space-y-3 text-sm"><li><a class="items-center gap-2 dark:text-gray-300 hover:text-[#ffcd00] inline-flex text-gray-600"href="#"id="open-terms-modal-btn"><i class="text-[#ffcd00] flex-shrink-0 h-4 w-4"data-lucide="shield"></i> <span>شروط الاستخدام</span></a><li><a class="items-center gap-2 dark:text-gray-300 hover:text-[#ffcd00] inline-flex text-gray-600"href="#"id="open-help-modal-btn"><i class="text-[#ffcd00] flex-shrink-0 h-4 w-4"data-lucide="help-circle"></i> <span>مساعدة</span></a></ul></div><div class="sm:text-right text-center"><h3 class="font-semibold dark:text-white sm:text-lg text-base mb-4 text-gray-900">اتصل بنا</h3><ul class="dark:text-gray-300 text-gray-600 space-y-3 text-sm"><li class="flex justify-center gap-3 sm:justify-start items-start"><i class="text-[#ffcd00] flex-shrink-0 h-4 w-4 mt-1"data-lucide="phone"></i> <a class="hover:text-[#ffda33]"href="tel:0225071272"dir="ltr">0225071272 (المتجر)</a><li class="flex justify-center gap-3 sm:justify-start items-start"><i class="text-[#ffcd00] flex-shrink-0 h-4 w-4 mt-1"data-lucide="smartphone"></i> <a class="hover:text-[#ffda33]"href="https://wa.me/201146641942"dir="ltr">01146641942 (واتساب)</a><li class="flex justify-center gap-3 sm:justify-start items-start"><i class="text-[#ffcd00] flex-shrink-0 h-4 w-4 mt-1"data-lucide="mail"></i> <a class="hover:text-[#ffda33]"href="mailto:macaelctrec@gmail.com">macaelctrec@gmail.com</a></ul></div></div></div><div class="border-t border-gray-200 dark:border-gray-700 mt-8 pt-6"><div class="flex items-center justify-between flex-col gap-4 sm:flex-row"><p class="text-gray-500 dark:text-gray-400 text-sm sm:text-right text-center">© 2025 متجر مكة للأدوات الكهربائية. جميع الحقوق محفوظة.<div class="sm:text-left text-center"dir="ltr"><div><span class="font-medium block dark:text-gray-400 text-gray-500 text-xs tracking-wider uppercase">Developed By</span> <span class="block text-sm dark:text-white font-semibold text-gray-900">Badr Ibrahim & Mostafa Mahmoud</span></div><div class="flex items-center justify-center gap-3 mt-2 sm:justify-start"><a class="dark:text-gray-300 text-gray-600 p-2 bg-gray-100 dark:bg-gray-700 dark:hover:bg-[#ffcd00] dark:hover:text-gray-900 hover:bg-[#ffcd00] hover:text-gray-900 rounded-lg shadow-sm transition-colors"href="tel:01069913150"title="Call 01069913150"><i class="h-4 w-4"data-lucide="phone-call"></i> <span class="sr-only">01069913150</span> </a><a class="dark:text-gray-300 text-gray-600 p-2 bg-gray-100 dark:bg-gray-700 dark:hover:bg-[#ffcd00] dark:hover:text-gray-900 hover:bg-[#ffcd00] hover:text-gray-900 rounded-lg shadow-sm transition-colors"href="https://badre.site/"title="Visit badre.site"rel="noopener noreferrer"target="_blank"><i class="h-4 w-4"data-lucide="external-link"></i> <span class="sr-only">badre.site</span></a></div></div></div></div></div></footer><a class="rounded-full shadow-lg bg-green-500 bottom-6 fixed hover:scale-110 p-3 right-6 sm:p-4 text-white transform transition-transform whatsapp-fab z-40"href="https://wa.me/201146641942"target="_blank"rel="noopener noreferrer"><span class="sr-only">تواصل معنا عبر واتساب</span> <svg class="h-6 w-6 sm:h-8 sm:w-8"fill="currentColor"viewBox="0 0 24 24"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.59 15.36 3.45 16.86L2.06 21.94L7.31 20.58C8.75 21.38 10.36 21.82 12.04 21.82C17.5 21.82 21.95 17.37 21.95 11.91C21.95 6.45 17.5 2 12.04 2M12.04 20.13C10.59 20.13 9.17 19.74 7.96 19L7.6 18.78L4.47 19.65L5.37 16.62L5.13 16.26C4.33 14.98 3.86 13.48 3.86 11.91C3.86 7.39 7.54 3.71 12.04 3.71C16.54 3.71 20.22 7.39 20.22 11.91C20.22 16.43 16.54 20.13 12.04 20.13M17.47 14.3C17.18 14.16 15.91 13.54 15.65 13.45C15.4 13.35 15.21 13.3 15.03 13.59C14.84 13.88 14.31 14.5 14.17 14.64C14.02 14.79 13.88 14.84 13.59 14.7C13.3 14.55 12.42 14.26 11.39 13.3C10.59 12.55 10.05 11.64 9.85 11.35C9.66 11.06 9.76 10.95 9.88 10.83C9.99 10.71 10.13 10.53 10.27 10.38C10.42 10.24 10.47 10.12 10.61 9.88C10.76 9.63 10.66 9.42 10.57 9.22C10.47 9.03 9.93 7.76 9.73 7.27C9.54 6.78 9.34 6.83 9.19 6.82C9.05 6.81 8.86 6.81 8.67 6.81C8.49 6.81 8.19 6.91 7.94 7.15C7.69 7.4 7.11 7.93 7.11 9.1C7.11 10.27 7.97 11.39 8.11 11.53C8.26 11.68 9.93 14.19 12.39 15.2C13.01 15.48 13.51 15.62 13.9 15.74C14.51 15.9 15.03 15.86 15.43 15.81C15.89 15.75 16.96 15.14 17.21 14.85C17.46 14.56 17.46 14.36 17.41 14.3Z"></path></svg></a></div><div class="flex items-center justify-center backdrop-blur-sm bg-black bg-opacity-75 fixed hidden inset-0 modal p-4 z-50"id="add-product-modal"style="animation:fadeIn .3s ease-out"><div class="flex flex-col max-h-[90vh] overflow-hidden shadow-2xl w-full bg-white dark:bg-[#2c2f38] m-4 rounded-xl max-w-3xl"><div class="flex items-center justify-between border-b border-gray-200 dark:border-gray-700 p-6 flex-shrink-0"><h2 class="font-bold text-2xl"id="modal-title">إضافة منتج جديد</h2><button class="rounded-full p-2 hover:text-red-500 dark:text-gray-300 text-gray-600"id="close-add-product-modal-btn"><i class="h-6 w-6"data-lucide="x"></i></button></div><form class="sm:p-8 p-6 overflow-y-auto space-y-6"id="add-product-form"><div class="grid grid-cols-1 gap-6 md:grid-cols-2"><div><label class="font-medium block mb-1 text-sm"for="productName">اسم المنتج</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="productName"required></div><div><label class="font-medium block mb-1 text-sm"for="productCategory">القسم</label> <select class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="productCategory"required><option value="Lighting">إضاءة<option value="Cables">كابلات<option value="Switches">مفاتيح<option value="Paints">دهانات<option value="Parts">قطع غيار<option value="Other">أخرى</select></div></div><div><label class="font-medium block mb-1 text-sm"for="productImageUrls">روابط الصور (مفصولة بفاصلة)</label> <textarea class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="productImageUrls"rows="3"placeholder="https://...image1.jpg, https://...image2.png"></textarea><p class="text-gray-500 text-xs mt-1">الصورة الأولى ستكون هي الصورة الرئيسية.</div><div><label class="font-medium block mb-1 text-sm"for="productDescription">الوصف</label> <textarea class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="productDescription"rows="4"></textarea></div><div class="grid grid-cols-1 gap-6 md:grid-cols-3"><div><label class="font-medium block mb-1 text-sm"for="productPrice">السعر (EGP)</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="productPrice"type="number"required step="0.01"></div><div class="flex items-center pt-6"><input class="focus:ring-[#ffcd00] border-gray-300 h-4 rounded text-[#ffcd00] w-4"id="isOnSale"type="checkbox"> <label class="font-medium text-sm mr-3"for="isOnSale">عليه عرض؟</label></div><div class="hidden"id="original-price-container"><label class="font-medium block mb-1 text-sm"for="originalPrice">السعر الأصلي (قبل الخصم)</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="originalPrice"type="number"step="0.01"></div></div><div class="flex items-center pt-2"><input class="focus:ring-[#ffcd00] border-gray-300 h-4 rounded text-[#ffcd00] w-4"id="isBestSeller"type="checkbox"> <label class="font-medium text-sm mr-3"for="isBestSeller">من الأكثر مبيعاً؟</label></div><hr class="border-gray-200 dark:border-gray-700"><h3 class="font-semibold text-lg">مواصفات إضافية (اختياري)</h3><div class="grid grid-cols-2 gap-6 md:grid-cols-3"><div><label class="font-medium block mb-1 text-sm"for="productCompany">الشركة</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="productCompany"></div><div><label class="font-medium block mb-1 text-sm"for="productVolts">الجهد (Volts)</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="productVolts"></div><div><label class="font-medium block mb-1 text-sm"for="productLength">الطول (Meters)</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="productLength"></div><div><label class="font-medium block mb-1 text-sm"for="productWarranty">الضمان</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="productWarranty"></div><div><label class="font-medium block mb-1 text-sm"for="productMadeIn">صنع في</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="productMadeIn"></div><div><label class="font-medium block mb-1 text-sm"for="productModel">رقم الموديل</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="productModel"></div></div></form><div class="flex items-center p-6 border-gray-200 dark:border-gray-700 flex-shrink-0 border-t gap-4 justify-end"><button class="font-medium dark:text-gray-200 py-2 bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300 rounded-lg text-gray-800 px-6"id="cancel-add-product-btn"type="button">إلغاء</button> <button class="font-bold text-gray-900 bg-[#ffcd00] hover:bg-[#ffda33] rounded-lg px-6 shadow-md py-2"id="modal-submit-btn"type="submit"form="add-product-form">حفظ المنتج</button></div></div></div><div class="flex items-center justify-center backdrop-blur-sm bg-black bg-opacity-75 fixed hidden inset-0 modal p-4 z-50"id="add-article-modal"style="animation:fadeIn .3s ease-out"><div class="flex flex-col max-h-[90vh] overflow-hidden shadow-2xl w-full bg-white dark:bg-[#2c2f38] m-4 rounded-xl max-w-3xl"><div class="flex items-center justify-between border-b border-gray-200 dark:border-gray-700 p-6 flex-shrink-0"><h2 class="font-bold text-2xl"id="article-modal-title">إضافة مقالة جديدة</h2><button class="rounded-full p-2 hover:text-red-500 dark:text-gray-300 text-gray-600"id="close-add-article-modal-btn"><i class="h-6 w-6"data-lucide="x"></i></button></div><form class="sm:p-8 p-6 overflow-y-auto space-y-6"id="add-article-form"><div><label class="font-medium block mb-1 text-sm"for="articleTitle">عنوان المقالة</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="articleTitle"required></div><div><label class="font-medium block mb-1 text-sm"for="articleImageUrl">رابط صورة المقالة</label> <input class="w-full rounded-lg py-3 bg-gray-100 border-transparent dark:bg-[#3d474e] focus:border-[#ffcd00] focus:ring-[#ffcd00] px-4"id="articleImageUrl"placeholder="https://...image.jpg"required></div><hr class="border-gray-200 dark:border-gray-700"><h3 class="font-semibold text-lg">محتوى المقالة</h3><div class="space-y-4"id="article-paragraphs-container"></div><div class="flex gap-4"><button class="flex items-center justify-center rounded-lg flex-1 bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-200 font-medium gap-2 hover:bg-gray-300 px-4 py-2 text-gray-800"id="add-paragraph-btn"type="button"><i class="h-4 w-4"data-lucide="plus"></i> <span>إضافة فقرة</span></button> <button class="flex items-center justify-center rounded-lg flex-1 bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-200 font-medium gap-2 hover:bg-gray-300 px-4 py-2 text-gray-800"id="add-gallery-btn"type="button"><i class="h-4 w-4"data-lucide="image"></i> <span>إضافة معرض صور</span></button></div></form><div class="flex items-center p-6 border-gray-200 dark:border-gray-700 flex-shrink-0 border-t gap-4 justify-end"><button class="font-medium dark:text-gray-200 py-2 bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300 rounded-lg text-gray-800 px-6"id="cancel-add-article-btn"type="button">إلغاء</button> <button class="font-bold text-gray-900 bg-[#ffcd00] hover:bg-[#ffda33] rounded-lg px-6 shadow-md py-2"id="article-modal-submit-btn"type="submit"form="add-article-form">حفظ المقالة</button></div></div></div><div class="flex items-center justify-center backdrop-blur-sm bg-black bg-opacity-75 fixed hidden inset-0 modal p-4 z-50"id="terms-modal"style="animation:fadeIn .3s ease-out"><div class="flex flex-col max-h-[90vh] overflow-hidden shadow-2xl w-full bg-white dark:bg-[#2c2f38] m-4 rounded-xl max-w-2xl"><div class="flex items-center justify-between border-b border-gray-200 dark:border-gray-700 p-6"><h2 class="font-bold text-2xl">شروط الاستخدام</h2><button class="rounded-full p-2 hover:text-red-500 dark:text-gray-300 text-gray-600"id="close-terms-modal-btn"><i class="h-6 w-6"data-lucide="x"></i></button></div><div class="sm:p-8 p-6 overflow-y-auto dark:prose-invert max-w-none prose prose-lg space-y-4"><h3>مرحباً بك في متجر مكة</h3><p>باستخدامك لهذا الموقع، فإنك توافق على الالتزام بالشروط والأحكام التالية. يرجى قراءتها بعناية.<h4>1. استخدام الموقع</h4><p>يجب استخدام هذا الموقع لأغراض مشروعة فقط. يُمنع استخدامه في أي نشاط قد يشكل انتهاكًا للقوانين المحلية أو الدولية.<h4>2. المنتجات والأسعار</h4><p>نحن نسعى جاهدين لضمان دقة معلومات المنتجات والأسعار، ولكن قد تحدث أخطاء. نحتفظ بالحق في تصحيح أي أخطاء وتحديث المعلومات في أي وقت دون إشعار مسبق. جميع الأسعار بالجنيه المصري.<h4>3. الطلبات</h4><p>تعتمد عملية إتمام الطلب على توفر المنتجات. حاليًا، يتم إتمام الطلبات وتأكيدها عبر التواصل المباشر (مثل واتساب) بعد إرسال الفاتورة المبدئية من الموقع.<h4>4. سياسة الخصوصية</h4><p>نحن نحترم خصوصيتك. المعلومات التي نجمعها (مثل عند استخدام "تسجيل الدخول بحساب جوجل") تُستخدم فقط لإدارة حسابك وتسهيل عملية الطلب. نحن لا نشارك بياناتك الشخصية مع أطراف ثالثة دون موافقتك.<h4>5. المساعد الذكي (AI)</h4><p>المساعد الذكي متوفر لتقديم معلومات عن المنتجات ونصائح عامة. المعلومات المقدمة من المساعد الذكي هي لأغراض إرشادية وقد لا تكون دقيقة بنسبة 100%. للحصول على تأكيد نهائي بخصوص المواصفات أو الأسعار، يرجى التواصل مع فريقنا مباشرة.<h4>6. حقوق الملكية الفكرية</h4><p>جميع المحتويات على هذا الموقع، بما في ذلك النصوص، الرسومات، الشعارات، والصور، هي ملك لـ "متجر مكة" ومحمية بموجب قوانين حقوق النشر.</div></div></div><div class="flex justify-end ai-modal-backdrop bg-black/50 duration-300 fixed hidden inset-0 items-end modal p-0 sm:p-4 transition-opacity z-50"id="gemini-help-modal"data-state="closed"><div class="flex flex-col max-h-[90vh] overflow-hidden shadow-2xl w-full backdrop-blur-lg bg-white/90 border border-white/20 dark:bg-[#2c2824]/90 dark:border-white/10 duration-300 ease-out max-w-full opacity-0 rounded-t-2xl sm:max-h-[700px] sm:max-w-md sm:rounded-2xl transition-all translate-y-6"id="gemini-help-panel"><div class="flex items-center justify-between border-b flex-shrink-0 border-white/20 dark:border-white/10 p-4"><div class="flex items-center gap-3"><span class="flex items-center justify-center bg-gradient-to-br from-[#ffcd00] h-10 overflow-hidden relative rounded-full shrink-0 to-[#ffb700] w-10"><i class="h-6 w-6 text-gray-900"data-lucide="sparkles"></i></span><div><h2 class="font-semibold text-base">المساعد الذكي</h2><p class="text-gray-500 dark:text-gray-400 text-xs">اسألني عن المنتجات أو اطلب نصيحة</div></div><div class="flex gap-1"><button class="rounded-full p-2 dark:hover:bg-gray-700 dark:text-gray-400 hover:bg-gray-100 text-gray-500 transition-colors dark:hover:text-blue-400 hover:text-blue-500"id="clear-chat-btn"title="بدء محادثة جديدة"><i class="h-5 w-5"data-lucide="refresh-ccw"></i></button> <button class="rounded-full p-2 dark:hover:bg-gray-700 dark:text-gray-400 hover:bg-gray-100 text-gray-500 transition-colors dark:hover:text-red-400 hover:text-red-500"id="close-help-modal-btn"title="إغلاق"><i class="h-5 w-5"data-lucide="x"></i></button></div></div><div class="flex flex-col bg-transparent flex-1 overflow-y-auto p-4 space-y-4"id="chat-history"><div class="self-start model-message">أهلاً بك في متجر مكة! كيف يمكنني مساعدتك اليوم؟</div><div class="hidden loading-dots self-start"id="loading-indicator"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div></div><form class="flex-shrink-0 p-4 border-t border-white/20 dark:border-white/10 bg-transparent"id="help-form"><div class="flex items-center relative"><input class="w-full py-3 px-4 focus:border-[#ffcd00] focus:ring-[#ffcd00] bg-white/80 border border-gray-200/80 dark:bg-gray-900/50 dark:border-gray-500/50 pr-12 rounded-full transition-colors"id="help-input"placeholder="ابحث عن منتج أو اطلب نصيحة..."style="padding-left:52px"> <button class="rounded-full absolute bg-[#ffcd00] text-gray-900 disabled:opacity-50 hover:bg-[#ffda33] left-2 p-2.5 right-auto shadow-sm transition-colors"type="submit"style="left:8px"><i class="h-5 w-5"data-lucide="send"></i></button></div></form></div></div><script type="module">import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup, 
            onAuthStateChanged, 
            signOut,
            setPersistence,
            browserSessionPersistence 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            onSnapshot, 
            query,
            Timestamp,
            deleteDoc, 
            doc,        
            updateDoc,
            setDoc,
            getDoc
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        
        const firebaseConfig = {
          apiKey: "AIzaSyBfslkMwWAmFXLPJ_aJZgSA7-59AhoOdUY",
          authDomain: "macaelctrec-f7795.firebaseapp.com",
          projectId: "macaelctrec-f7795",
          storageBucket: "macaelctrec-f7795.firebasestorage.app",
          messagingSenderId: "915102271751",
          appId: "1:915102271751:web:38cf552556f3cc5be15da2",
          measurementId: "G-231CS0RBZD"
        };

        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app); 
        const provider = new GoogleAuthProvider();
 
        setPersistence(auth, browserSessionPersistence);

        
        let allProducts = [];
        let allArticles = []; 
        let modalListenerAttached = false; 
        let articleModalListenerAttached = false; 
        let currentIsAdmin = false; 
        let preFilterType = 'all'; 
        let defaultProductsCheckDone = false; 

        let aiChatHistory = [];
        const defaultSuggestions = [
            "ما هي أفضل العروض؟",
            "أبحث عن إضاءة ليد",
            "ما هي المنتجات الأكثر مبيعاً؟",
            "أحتاج مساعدة في اختيار كابل"
        ];
        
        let currentGalleryImages = [];
        let currentGalleryIndex = 0;

        
        function generateShortId(length = 5) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        
        function showToast(message) {
            const existingToast = document.querySelector('.toast-notification');
            if (existingToast) {
                existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }


        function updateGalleryView(index) {
            const mainImgEl = document.getElementById('main-product-image');
            const thumbnailContainer = document.getElementById('details-thumbnail-container');

            if (!mainImgEl || !thumbnailContainer || currentGalleryImages.length === 0) return;


            currentGalleryIndex = (index + currentGalleryImages.length) % currentGalleryImages.length;

            const newImageUrl = currentGalleryImages[currentGalleryIndex];
            

            mainImgEl.src = newImageUrl;

            const thumbnails = thumbnailContainer.querySelectorAll('img');
            thumbnails.forEach((img, i) => {
                img.classList.toggle('border-[#ffcd00]', i === currentGalleryIndex);
                img.classList.toggle('border-transparent', i !== currentGalleryIndex);
            });
        }

        
        const loginBtn = document.getElementById('google-login-btn');
        const logoutBtn = document.getElementById('google-logout-btn');
        const userInfo = document.getElementById('user-info');
        const userAvatar = document.getElementById('user-avatar');
        const loginBtnMobile = document.getElementById('google-login-btn-mobile');
        const logoutBtnMobile = document.getElementById('google-logout-btn-mobile');
        const userInfoMobile = document.getElementById('user-info-mobile');
        const userAvatarMobile = document.getElementById('user-avatar-mobile');
        const userNameMobile = document.getElementById('user-name-mobile');
        
        
        
        const signInWithGoogle = (e) => {
            e.preventDefault();
            signInWithPopup(auth, provider)
                .then((result) => {
                    const user = result.user;
                    const email = user.email;

                    if (email === "macaelctrec@gmail.com") {
                        console.log('User signed in:', user.displayName);
                        showToast(`!أهلاً بك، ${user.displayName}`);
                    } else {
                        console.warn(`Unauthorized email attempt: ${email}`);
                        signOut(auth);
                        showToast('عذراً، هذا الحساب غير مصرح له بتسجيل الدخول.');
                    }

                }).catch((error) => {
                    console.error('Google Sign-In Error:', error.message);
                    showToast('فشل تسجيل الدخول. يرجى المحاولة مرة أخرى.');
                });
        };
 
        
        const signOutGoogle = (e) => {
            e.preventDefault(); 
            signOut(auth).then(() => {
                console.log('User signed out.');
                showToast('You have been logged out.');
            }).catch((error) => {
                console.error('Sign Out Error:', error);
            });
        };
 
        
        if(loginBtn) loginBtn.addEventListener('click', signInWithGoogle);
        if(logoutBtnMobile) logoutBtnMobile.addEventListener('click', signOutGoogle);
        if(loginBtnMobile) loginBtnMobile.addEventListener('click', signInWithGoogle);
        if(logoutBtnMobile) logoutBtnMobile.addEventListener('click', signOutGoogle);
 

        const userAvatarBtn = document.getElementById('user-avatar-btn');
        const userDropdownMenu = document.getElementById('user-dropdown-menu');

        if (userAvatarBtn && userDropdownMenu) {
            userAvatarBtn.addEventListener('click', (e) => {
                e.stopPropagation(); 
                const state = userDropdownMenu.dataset.state === 'open' ? 'closed' : 'open';
                userDropdownMenu.dataset.state = state;
            });


            window.addEventListener('click', (e) => {
                if (userDropdownMenu.dataset.state === 'open') {
                    if (!userAvatarBtn.contains(e.target) && !userDropdownMenu.contains(e.target)) {
                        userDropdownMenu.dataset.state = 'closed';
                    }
                }
            });
        }

 
        
        onAuthStateChanged(auth, (user) => {
            const isAdmin = user && user.email === "macaelctrec@gmail.com";
            currentIsAdmin = isAdmin; 
            

            const dropdownAdminLink = document.getElementById('dropdown-admin-link'); // +++ ADJUSTED THIS +++
 
            if (user) { 
                const photo = user.photoURL || 'https://placehold.co/32x32/eeeeee/777777?text=User';
                
                
                if(userInfo) userInfo.classList.remove('hidden');
                if(userInfo) userInfo.classList.add('flex');
                if(userAvatar) userAvatar.src = photo;
                
               
                if(loginBtn) loginBtn.classList.remove('sm:inline-flex'); 
        

             
                if(userInfoMobile) userInfoMobile.classList.remove('hidden');
                if(userInfoMobile) userInfoMobile.classList.add('flex');
                if(userAvatarMobile) userAvatarMobile.src = photo;
                if(userNameMobile) userNameMobile.textContent = user.displayName;
                if(loginBtnMobile) loginBtnMobile.style.display = 'none';
 
               
                const dropdownLogout = document.getElementById('google-logout-btn-dropdown');
                if (dropdownLogout) {
                    if (!dropdownLogout.dataset.listenerAttached) {
                        dropdownLogout.addEventListener('click', signOutGoogle);
                        dropdownLogout.dataset.listenerAttached = 'true';
                    }
                }
                
                const dropdownAdmin = document.getElementById('dropdown-admin-link');
                if (dropdownAdmin) {
                    if (!dropdownAdmin.dataset.listenerAttached) {
                        dropdownAdmin.addEventListener('click', (e) => {
                            
                            userDropdownMenu.dataset.state = 'closed'; 
                        });
                        dropdownAdmin.dataset.listenerAttached = 'true';
                    }
                }
 
            } else { 
                
                if(userInfo) userInfo.classList.add('hidden');
                if(userInfo) userInfo.classList.remove('flex');
                if(userAvatar) userAvatar.src = '';


                if(loginBtn) loginBtn.classList.add('sm:inline-flex'); 



                if(userInfoMobile) userInfoMobile.classList.add('hidden');
                if(userInfoMobile) userInfoMobile.classList.remove('flex');
                if(userAvatarMobile) userAvatarMobile.src = '';
                if(userNameMobile) userNameMobile.textContent = '';
                if(loginBtnMobile) loginBtnMobile.style.display = 'block';
            }

            
            const addProductBtn = document.getElementById('show-add-product-modal-btn');
            const addArticleBtn = document.getElementById('show-add-article-modal-btn'); // +++++ NEW +++++
            
            if (isAdmin) {
                if(addProductBtn) {
                    addProductBtn.classList.remove('hidden');
                    addProductBtn.classList.add('inline-flex'); 

                    
                    if (!modalListenerAttached) {
                        console.log("Admin detected. Attaching modal listener...");
                        const modal = document.getElementById('add-product-modal'); 
                        console.log("Found modal element:", modal); 
                        
                        addProductBtn.addEventListener('click', () => {
                            console.log("'Add Product' button clicked, showing modal.");
                            if (modal) {
                                modal.classList.remove('hidden');
                            } else {
                                console.error("Modal element not found!");
                            }
                        });
                        modalListenerAttached = true; 
                    }
                }


                if(addArticleBtn) {
                    addArticleBtn.classList.remove('hidden');
                    addArticleBtn.classList.add('inline-flex');

                    if (!articleModalListenerAttached) {
                        const articleModal = document.getElementById('add-article-modal');
                        if (articleModal) {
                            addArticleBtn.addEventListener('click', () => {
                                resetArticleModalToAddMode(); 
                                articleModal.classList.remove('hidden');
                            });
                            articleModalListenerAttached = true;
                        }
                    }
                }

  
                if(dropdownAdminLink) dropdownAdminLink.classList.remove('hidden'); // +++ ADJUSTED THIS +++
 
 
            } else {
                if(addProductBtn) {
                    addProductBtn.classList.add('hidden');
                    addProductBtn.classList.remove('inline-flex');
                }
                modalListenerAttached = false; 


                if(addArticleBtn) {
                    addArticleBtn.classList.add('hidden');
                    addArticleBtn.classList.remove('inline-flex');
                }
                articleModalListenerAttached = false;

               
                if(dropdownAdminLink) dropdownAdminLink.classList.add('hidden'); // +++ ADJUSTED THIS +++
 
            }
            
            renderAllProductViews(); 
            renderArticles(); 
            
            
            
            
            loadProducts(); 
            loadArticles(); 
            loadSiteConfig(); 
        });

        let cart = []; 
            const cartCountBadge = document.getElementById('cart-count-badge');
            const mobileCartCountBadge = document.getElementById('mobile-cart-count-badge');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const cartEmptyMessage = document.getElementById('cart-empty-message');
            const cartSummary = document.getElementById('cart-summary');
            const cartSubtotalEl = document.getElementById('cart-subtotal');
            const cartTotalEl = document.getElementById('cart-total');

            function addToCart(product, quantity = 1) {
                if (!product.id || !product.name || !product.price || !product.image) {
                    console.error('Invalid product data:', product);
                    return;
                }
                const existingProduct = cart.find(item => item.id === product.id);
                if (existingProduct) {
                    existingProduct.quantity += quantity;
                } else {
                    cart.push({ ...product, quantity: quantity });
                }
                updateCartView();
                
                const toastMessage = quantity > 1 
                    ? `تمت إضافة ${quantity} x "${product.name}" إلى السلة!`
                    : `تمت إضافة "${product.name}" إلى السلة!`;
                showToast(toastMessage);
            }

            function updateCartView() {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

                if (totalItems > 0) {
                    cartCountBadge.textContent = totalItems;
                    mobileCartCountBadge.textContent = totalItems;
                    cartCountBadge.classList.remove('hidden');
                    mobileCartCountBadge.classList.remove('hidden');
                } else {
                    cartCountBadge.classList.add('hidden');
                    mobileCartCountBadge.classList.add('hidden');
                }
                
                if (document.getElementById('page-cart').classList.contains('active')) {
                    renderCartPage();
                }
            }

            function renderCartPage() {
                if (!cartItemsContainer || !cartEmptyMessage || !cartSummary) return;

                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '';
                    cartEmptyMessage.classList.remove('hidden');
                    cartSummary.classList.add('hidden');
                } else {
                    cartEmptyMessage.classList.add('hidden');
                    cartSummary.classList.remove('hidden');
                    
                    cartItemsContainer.innerHTML = cart.map(item => `
                        <div class="flex flex-col sm:flex-row items-center gap-4 p-4 border-b border-gray-200 dark:border-gray-700" data-cart-item-id="${item.id}">
                            <img src="${item.image}" alt="${item.name}" class="w-24 h-24 object-cover rounded-lg">
                            <div class="flex-grow text-center sm:text-left">
                                <h3 class="text-lg font-semibold">${item.name}</h3>
                                <p class="text-sm text-gray-500">${item.id}</p>
                            </div>
                            <div class="flex items-center gap-2 sm:gap-4">
                                <input type="number" value="${item.quantity}" min="1" class="cart-item-quantity w-16 px-3 py-2 rounded-lg bg-gray-100 dark:bg-[#3d474e] border-transparent focus:border-[#ffcd00] focus:ring-[#ffcd00]" data-product-id="${item.id}">
                                <p class="text-lg font-bold w-28 text-right">${(parseFloat(item.price) * item.quantity).toFixed(2)} EGP</p>
                                <button class="remove-from-cart-btn text-red-500 hover:text-red-400" data-product-id="${item.id}" title="Remove item">
                                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');

                    const subtotal = cart.reduce((sum, item) => sum + (parseFloat(item.price) * item.quantity), 0);
                    cartSubtotalEl.textContent = `${subtotal.toFixed(2)} EGP`;
                    cartTotalEl.textContent = `${subtotal.toFixed(2)} EGP`; 

                    addCartItemListeners();
                }
                lucide.createIcons();
            }

            function addCartItemListeners() {
                document.querySelectorAll('.remove-from-cart-btn').forEach(btn => {
                    const newBtn = btn.cloneNode(true);
                    btn.parentNode.replaceChild(newBtn, btn);
                    newBtn.addEventListener('click', (e) => {
                        const productId = e.currentTarget.dataset.productId;
                        removeFromCart(productId);
                    });
                });

                document.querySelectorAll('.cart-item-quantity').forEach(input => {
                    const newInput = input.cloneNode(true);
                    input.parentNode.replaceChild(newInput, input);
                    newInput.addEventListener('change', (e) => {
                        const productId = e.currentTarget.dataset.productId;
                        const newQuantity = parseInt(e.currentTarget.value, 10);
                        updateCartQuantity(productId, newQuantity);
                    });
                });
            }

            function removeFromCart(productId) {
                cart = cart.filter(item => item.id !== productId);
                updateCartView();
                renderCartPage();
            }

            function updateCartQuantity(productId, quantity) {
                if (quantity < 1) {
                    removeFromCart(productId);
                    return;
                }
                const product = cart.find(item => item.id === productId);
                if (product) {
                    product.quantity = quantity;
                }
                updateCartView();
                renderCartPage();
            }

            function generateWhatsAppInvoice() {
                if (cart.length === 0) {
                    showToast("سلّتك فارغة.");
                    return;
                }

                const storeName = "متجر مكة للأدوات الكهربائية";
                const phone = "201146641942"; 

                let message = `*فاتورة طلب جديد*\n`;
                message += `------------------------\n`;
                message += `*المتجر:* ${storeName}\n\n`;
                
                message += `*تفاصيل الطلب:*\n`;
                let subtotal = 0;
                cart.forEach((item, index) => {
                    const itemTotal = parseFloat(item.price) * item.quantity;
                    subtotal += itemTotal;
                    message += `${index + 1}. *${item.name}*\n`;
                    message += `   - الكمية: ${item.quantity}\n`;
                    message += `   - سعر الوحدة: ${parseFloat(item.price).toFixed(2)} جنيه\n`;
                    message += `   - إجمالي الصنف: ${itemTotal.toFixed(2)} جنيه\n\n`;
                });

                message += `------------------------\n`;
                message += `*المبلغ الإجمالي:* ${subtotal.toFixed(2)} جنيه\n\n`;
                message += `برجاء تأكيد هذا الطلب للمتابعة.`;
                
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/${phone}?text=${encodedMessage}`;

                window.open(whatsappUrl, '_blank');
            }

            
            function setupAddToCartButtons() {
                document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                    if (btn.dataset.listenerAttached) return;
                    btn.dataset.listenerAttached = 'true';

                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        
                        const card = e.currentTarget.closest('.product-card-wrapper');
                        if (!card) return;

                        const product = {
                            id: card.dataset.productId,
                            name: card.dataset.productName,
                            price: card.dataset.productPrice,
                            image: card.dataset.productImage
                        };
                        

                        let quantityToAdd = 1;
                        const quantityInput = card.querySelector('#details-quantity-input');
                        if (quantityInput) {
                            quantityToAdd = parseInt(quantityInput.value, 10) || 1;
                            if (quantityToAdd < 1) quantityToAdd = 1;
                        }

                        
                        addToCart(product, quantityToAdd);
                    });
                });
            }
            


            
            const modal = document.getElementById('add-product-modal');
            const modalTitle = document.getElementById('modal-title'); 
            const modalSubmitBtn = document.getElementById('modal-submit-btn'); 
            
            const closeModalBtn = document.getElementById('close-add-product-modal-btn');
            const cancelModalBtn = document.getElementById('cancel-add-product-btn');
            const addProductForm = document.getElementById('add-product-form');
            const isOnSaleCheckbox = document.getElementById('isOnSale');
            const originalPriceContainer = document.getElementById('original-price-container');

            
            
            
            
            function resetModalToAddMode() {
                if(modalTitle) modalTitle.textContent = "إضافة منتج جديد";
                if(modalSubmitBtn) modalSubmitBtn.textContent = "حفظ المنتج";
                if(addProductForm) {
                    addProductForm.reset();
                    delete addProductForm.dataset.editingId; 
                }
                if(originalPriceContainer) originalPriceContainer.classList.add('hidden');
            }

            if(closeModalBtn) closeModalBtn.addEventListener('click', () => {
                resetModalToAddMode(); 
                modal.classList.add('hidden');
            });
            if(cancelModalBtn) cancelModalBtn.addEventListener('click', () => {
                resetModalToAddMode(); 
                modal.classList.add('hidden');
            });
            
            if(isOnSaleCheckbox) isOnSaleCheckbox.addEventListener('change', (e) => {
                if (e.target.checked) {
                    originalPriceContainer.classList.remove('hidden');
                } else {
                    originalPriceContainer.classList.add('hidden');
                }
            });
                if(addProductForm) addProductForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const editingId = addProductForm.dataset.editingId; 

                
                const imageUrlsString = document.getElementById('productImageUrls').value;
                const imageUrls = imageUrlsString.split(',')       
                                                .map(url => url.trim())   
                                                .filter(url => url && url.length > 0); 
                const productData = { 
                    name: document.getElementById('productName').value,
                    price: parseFloat(document.getElementById('productPrice').value),
                    
                    imageUrls: imageUrls, 
                    category: document.getElementById('productCategory').value,
                    description: document.getElementById('productDescription').value,
                    isOnSale: document.getElementById('isOnSale').checked,
                    isBestSeller: document.getElementById('isBestSeller').checked,
                    originalPrice: document.getElementById('isOnSale').checked ? parseFloat(document.getElementById('originalPrice').value) : 0,
                    createdAt: Timestamp.now(),

                    
                    company: document.getElementById('productCompany').value,
                    volts: document.getElementById('productVolts').value,
                    length: document.getElementById('productLength').value,
                    warranty: document.getElementById('productWarranty').value,
                    madeIn: document.getElementById('productMadeIn').value,
                    model: document.getElementById('productModel').value
                };
                try {
                    if (editingId) {
                        
                        const productRef = doc(db, "products", editingId);
                        await updateDoc(productRef, productData);
                        showToast("تم تحديث المنتج بنجاح!");
                    } else {
                        
                        productData.createdAt = Timestamp.now(); 
                        productData.shortId = generateShortId(5); 
                        await addDoc(collection(db, "products"), productData);
                        showToast("تمت إضافة المنتج بنجاح!");
                    }
                    
                    resetModalToAddMode(); 
                    modal.classList.add('hidden'); 
                    
                } catch (error) {
                    console.error("Error saving document: ", error);
                    showToast("خطأ في حفظ المنتج. راجع الكونسول.");
                }
            });


            const articleModal = document.getElementById('add-article-modal');
            const articleModalTitle = document.getElementById('article-modal-title');
            const articleModalSubmitBtn = document.getElementById('article-modal-submit-btn');
            const closeArticleModalBtn = document.getElementById('close-add-article-modal-btn');
            const cancelArticleModalBtn = document.getElementById('cancel-add-article-btn');
            const addArticleForm = document.getElementById('add-article-form');


            function escapeHTML(str) {
                if (typeof str !== 'string') return '';
                return str.replace(/[&<>"']/g, function(match) {
                    return {
                        '&': '&amp;',
                        '<': '&lt;',
                        '>': '&gt;',
                        '"': '&quot;',
                        "'": '&#39;'
                    }[match];
                });
            }


            function createParagraphBlock(title = '', body = '') {
                const container = document.getElementById('article-paragraphs-container');
                if (!container) return;

                const block = document.createElement('div');

                block.className = 'content-block paragraph-block bg-gray-50 dark:bg-[#3d474e] p-3 rounded-lg border border-gray-200 dark:border-gray-600 relative';
                block.dataset.type = 'paragraph'; 
                
                    block.innerHTML = `
                    <button type="button" class="remove-block-btn absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 z-10" title="Remove block">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </button>
                    <div>
                        <label class="block text-xs font-medium mb-1 flex items-center gap-2">
                            <span class="paragraph-number text-base font-bold text-gray-500 dark:text-gray-400">1.</span>
                            <span>عنوان الفقرة (اختياري)</span>
                        </label>
                        <input type="text" class="paragraph-title w-full px-3 py-2 text-sm rounded-lg bg-white dark:bg-gray-800 border-transparent focus:border-[#ffcd00] focus:ring-[#ffcd00]" value="${escapeHTML(title)}">
                    </div>
                    <div class="mt-2">
                        <label class="block text-xs font-medium mb-1">محتوى الفقرة (اكتب كل نقطة في سطر مستقل)</label>
                        <textarea class="paragraph-body w-full px-3 py-2 text-sm rounded-lg bg-white dark:bg-gray-800 border-transparent focus:border-[#ffcd00] focus:ring-[#ffcd00]" rows="3">${escapeHTML(body)}</textarea>
                    </div>
                `;


                block.querySelector('.remove-block-btn').addEventListener('click', () => {
                    block.remove();
                    reNumberParagraphBlocks(); 
                });

                container.appendChild(block);
                lucide.createIcons();
            }


            function createGalleryBlock(images = []) {
                const container = document.getElementById('article-paragraphs-container');
                if (!container) return;

                const block = document.createElement('div');
                block.className = 'content-block gallery-block bg-gray-50 dark:bg-[#3d474e] p-3 rounded-lg border border-gray-200 dark:border-gray-600 relative';
                block.dataset.type = 'gallery'; 
                

                const imageUrls = images.join(', ');

                    block.innerHTML = `
                    <button type="button" class="remove-block-btn absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 z-10" title="Remove block">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </button>
                    <div>
                        <label class="block text-sm font-medium mb-1 flex items-center gap-2">
                            <i data-lucide="image" class="w-4 h-4 text-gray-500 dark:text-gray-400"></i>
                            <span>معرض الصور</span>
                        </label>
                        <textarea class="gallery-urls w-full px-3 py-2 text-sm rounded-lg bg-white dark:bg-gray-800 border-transparent focus:border-[#ffcd00] focus:ring-[#ffcd00]" rows="3" placeholder="الصق روابط الصور، مفصولة بفاصلة...">${escapeHTML(imageUrls)}</textarea>
                    </div>
                `;


                block.querySelector('.remove-block-btn').addEventListener('click', () => {
                    block.remove();

                });

                container.appendChild(block);
                lucide.createIcons();
            }


            const addParagraphBtn = document.getElementById('add-paragraph-btn');
            if (addParagraphBtn) {
                addParagraphBtn.addEventListener('click', () => {
                    createParagraphBlock(); 
                    reNumberParagraphBlocks();
                });
            }
            
            const addGalleryBtn = document.getElementById('add-gallery-btn');
            if (addGalleryBtn) {
                addGalleryBtn.addEventListener('click', () => {
                    createGalleryBlock(); 

                });
            }


            function reNumberParagraphBlocks() {
                const container = document.getElementById('article-paragraphs-container');
                if (!container) return;
                
                let paragraphCounter = 1;
                const blocks = container.querySelectorAll('.content-block');
                
                blocks.forEach((block) => {
                    
                    if (block.dataset.type === 'paragraph') {
                        const numSpan = block.querySelector('.paragraph-number');
                        if (numSpan) {
                            numSpan.textContent = `${paragraphCounter}.`;
                        }
                        paragraphCounter++;
                    }
                });
            }

            function resetArticleModalToAddMode() {
                if(articleModalTitle) articleModalTitle.textContent = "إضافة مقالة جديدة";
                if(articleModalSubmitBtn) articleModalSubmitBtn.textContent = "حفظ المقالة";
                if(addArticleForm) {
                    addArticleForm.reset();
                    delete addArticleForm.dataset.editingId;
                }
                
                
                const container = document.getElementById('article-paragraphs-container');
                if (container) {
                    container.innerHTML = '';
                }
                createParagraphBlock();
                reNumberParagraphBlocks();
                
            }

            if(closeArticleModalBtn) closeArticleModalBtn.addEventListener('click', () => {
                resetArticleModalToAddMode();
                if(articleModal) articleModal.classList.add('hidden');
            });
            if(cancelArticleModalBtn) cancelArticleModalBtn.addEventListener('click', () => {
                resetArticleModalToAddMode();
                if(articleModal) articleModal.classList.add('hidden');
            });

            if(addArticleForm) addArticleForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const editingId = addArticleForm.dataset.editingId;

                
                const contentArray = [];
                document.querySelectorAll('#article-paragraphs-container .content-block').forEach(block => {
                    const type = block.dataset.type;
                    
                    if (type === 'paragraph') {
                        const title = block.querySelector('.paragraph-title').value.trim();
                        const body = block.querySelector('.paragraph-body').value.trim();
                        
                        if (title || body) {
                            contentArray.push({ type: 'paragraph', title: title, body: body });
                        }
                    } else if (type === 'gallery') {
                        const urlsText = block.querySelector('.gallery-urls').value;
                        const images = urlsText.split(',')
                                            .map(url => url.trim())
                                            .filter(url => url.length > 0);
                        
                        if (images.length > 0) {
                            contentArray.push({ type: 'gallery', images: images });
                        }
                    }
                });
                

                const articleData = {
                    title: document.getElementById('articleTitle').value,
                    imageUrl: document.getElementById('articleImageUrl').value,
                    
                    content: contentArray,
                };

                try {
                    if (editingId) {
                        
                        const articleRef = doc(db, "articles", editingId);
                        await updateDoc(articleRef, articleData);
                        showToast("تم تحديث المقالة بنجاح!");
                    } else {
                        
                        articleData.createdAt = Timestamp.now();
                        articleData.shortId = generateShortId(5); 
                        await addDoc(collection(db, "articles"), articleData);
                        showToast("تمت إضافة المقالة بنجاح!");
                    }
                    resetArticleModalToAddMode();
                    if(articleModal) articleModal.classList.add('hidden');
                } catch (error) {
                    console.error("Error saving article: ", error);
                    showToast("خطأ في حفظ المقالة. راجع الكونسول.");
                }
            });
            


            function renderProductCard(product) {
                
                
                const mainImg = (product.imageUrls && product.imageUrls[0]) ? product.imageUrls[0] : (product.imageUrl || 'https://placehold.co/400x400/eeeeee/777777?text=Image+Error');

                const priceHTML = product.isOnSale
                    ? `<div class="flex items-baseline gap-1.5">
                           <span class="text-lg font-bold text-[#ffcd00]">${product.price.toFixed(2)} EGP</span>
                           <span class="text-sm text-gray-500 dark:text-gray-400 line-through">${product.originalPrice.toFixed(2)} EGP</span>
                       </div>`
                    : `<div class="flex items-baseline gap-1.5">
                           <span class="text-lg font-bold text-gray-900 dark:text-white">${product.price.toFixed(2)} EGP</span>
                        </div>`;

                let saleBadge = '';
                if (product.isOnSale && product.originalPrice && product.originalPrice > product.price) {
                    const discountPercent = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
                    if (discountPercent > 0) {
                        
                        saleBadge = `
                            <div class="sale-ribbon">
                                <span>خصم ${discountPercent}%</span>
                            </div>`;
                    } else {
                        
                        saleBadge = `
                            <div class="sale-ribbon">
                                <span>عرض</span>
                            </div>`;
                    }
                } else if (product.isOnSale) {
                    
                    saleBadge = `
                        <div class="sale-ribbon">
                            <span>عرض</span>
                        </div>`;
                }
                
                
                let descriptionSnippet = '';
                if (product.description && product.description.trim() !== '') {
                    const words = product.description.split(' ');
                    } else if (product.isOnSale) {
                    
                    saleBadge = `
                        <div class="sale-ribbon">
                            <span>Sale</span>
                        </div>`;
                }
                
                
                
                
                const deleteButtonHTML = currentIsAdmin
                    ? `<button class="delete-product-btn p-1.5 bg-red-600 text-white rounded-full hover:bg-red-700" title="حذف المنتج" data-product-id="${product.id}">
                           <i data-lucide="trash-2" class="w-4 h-4"></i>
                       </button>`
                    : '';
                
                
                const editButtonHTML = currentIsAdmin
                    ? `<button class="edit-product-btn p-1.5 bg-blue-600 text-white rounded-full hover:bg-blue-700" title="تعديل المنتج" data-product-id="${product.id}">
                           <i data-lucide="edit-3" class="w-4 h-4"></i>
                       </button>`
                    : '';
                
                const adminButtonsHTML = currentIsAdmin
                    ? `<div class="absolute top-3 right-3 z-10 flex flex-col gap-1.5">
                            ${editButtonHTML}
                            ${deleteButtonHTML}
                       </div>`
                    : '';
                
                


                return `
                <div class="product-card-wrapper bg-white dark:bg-[#2c2f38] rounded-2xl overflow-hidden shadow-md border border-gray-200 dark:border-gray-700 flex flex-col transition-all duration-300 hover:shadow-xl hover:border-[#ffcd00]/50"
                     data-product-id="${product.id}"
                     data-product-name="${product.name}"
                     data-product-price="${product.price}"
                     data-product-image="${mainImg}">
                    
                    
                    
                    <div class="relative overflow-hidden">
                        ${saleBadge}
                        <a href="#product/${product.shortId || product.id}" class="product-details-link" data-product-id="${product.id}">
                            <img class="w-full h-36 sm:h-48 lg:h-56 object-cover" 
                                 src="${mainImg}" 
                                 onerror="this.src='https://placehold.co/400x400/eeeeee/777777?text=Image+Error'"
                                 alt="${product.name}">
                        </a>
                        ${adminButtonsHTML}
                    </div>

                    <div class="p-4 flex-grow flex flex-col">
                        
                        <div class="flex justify-between items-start gap-2 mb-2">
                            <a href="#product/${product.shortId || product.id}" class="product-details-link flex-grow truncate" data-product-id="${product.id}" title="${product.name}">
                                <h3 class="text-base font-semibold text-gray-800 dark:text-white product-name">${product.name}</h3>
                            </a>
                        </div>
                        
                        
                        

                        
                        <div class="star-rating mb-2 text-sm">
                            ${generateStarRating()}
                        </div>
                        

                        <div class="mt-auto pt-2 space-y-3">
                            <div class="flex items-center justify-between gap-4">
                                ${priceHTML}
                            </div>
                            
                            
                            <div class="flex items-center gap-2">
                                <a href="#product/${product.shortId || product.id}" class="product-details-link flex-1 text-center px-4 py-2 bg-transparent border border-[#ffcd00] text-[#ffcd00] text-sm font-semibold rounded-lg hover:bg-[#ffcd00] hover:text-gray-900 dark:hover:text-gray-900 transition-colors" data-product-id="${product.id}">
                                    عرض التفاصيل
                                </a>
                                <button class="add-to-cart-btn flex-shrink-0 p-2 bg-[#ffcd00] text-gray-900 rounded-lg shadow-lg hover:bg-[#ffda33] transition-all duration-300" title="إضافة للسلة">
                                    <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                                 </button>
                            </div>
                            
                        </div>
                    </div>
                </div>`;
            }

            
            function generateStarRating() {
                
                const rating = Math.floor(Math.random() * 3) + 3;
                let starsHTML = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= rating) {
                        starsHTML += '<span>★</span>';
                    } else {
                        starsHTML += '<span class="text-gray-300 dark:text-gray-600">☆</span>';
                    }
                }
                return starsHTML;
            }
            

            function renderAllProductViews() {
                
                const searchTerm = document.getElementById('product-search-input').value.toLowerCase();
                const category = document.getElementById('product-category-filter').value;
                const sort = document.getElementById('product-sort-filter').value;

                
                let filteredProducts = allProducts;

                
                if (preFilterType === 'sale') {
                    filteredProducts = allProducts.filter(p => p.isOnSale);
                } else if (preFilterType === 'bestseller') {
                    filteredProducts = allProducts.filter(p => p.isBestSeller);
                }
                

                
                filteredProducts = filteredProducts.filter(p => 
                    p.name.toLowerCase().includes(searchTerm)
                );

                if (category !== 'all') {
                    filteredProducts = filteredProducts.filter(p => p.category === category);
                }

                
                if (sort === 'price-asc') {
                    filteredProducts.sort((a, b) => a.price - b.price);
                } else if (sort === 'price-desc') {
                    filteredProducts.sort((a, b) => b.price - a.price);
                }

                const offersGrid = document.getElementById('home-offers-grid');
                const bestsellersGrid = document.getElementById('home-bestsellers-grid');
                const productsGrid = document.getElementById('products-grid');
                const noProductsMessage = document.getElementById('no-products-message');

                if (!offersGrid || !bestsellersGrid || !productsGrid) return;

                
                offersGrid.innerHTML = '';
                bestsellersGrid.innerHTML = '';
                productsGrid.innerHTML = '';

                const offers = allProducts.filter(p => p.isOnSale).slice(0, 6); 
                const bestsellers = allProducts.filter(p => p.isBestSeller).slice(0, 6); 

                offers.forEach(p => offersGrid.innerHTML += renderProductCard(p));
                bestsellers.forEach(p => bestsellersGrid.innerHTML += renderProductCard(p));
                
                if (filteredProducts.length === 0) {
                    productsGrid.innerHTML = ''; 
                    productsGrid.classList.add('hidden'); 
                    noProductsMessage.classList.remove('hidden');
                } else {
                    noProductsMessage.classList.add('hidden');
                    productsGrid.classList.remove('hidden'); 
                    productsGrid.innerHTML = ''; 
                    filteredProducts.forEach(p => productsGrid.innerHTML += renderProductCard(p));
                }

                
                setupAddToCartButtons();
                setupDeleteProductButtons(); 
                setupEditProductButtons(); 
                // setupProductDetailsLinks(); // No longer needed, router handles this
                lucide.createIcons();
            }

            function setupDeleteProductButtons() {
                document.querySelectorAll('.delete-product-btn').forEach(btn => {
                    
                    if (btn.dataset.listenerAttached) return;
                    btn.dataset.listenerAttached = 'true';
                    
                    btn.addEventListener('click', async (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        
                        const productId = e.currentTarget.dataset.productId;
                        if (!productId) return;

                        
                        
                        console.log("Attempting to delete product:", productId);
                        await deleteProduct(productId);
                    });
                });
            }

            function setupEditProductButtons() {
                document.querySelectorAll('.edit-product-btn').forEach(btn => {
                    
                    if (btn.dataset.listenerAttached) return;
                    btn.dataset.listenerAttached = 'true';
                    
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        
                        const productId = e.currentTarget.dataset.productId;
                        if (!productId) return;

                        const product = allProducts.find(p => p.id === productId);
                        if (product) {
                            openEditModal(product);
                        } else {
                            console.error("Product not found for editing:", productId);
                        }
                    });
                });
            }

            
            function openEditModal(product) {
                if (!modal || !addProductForm || !modalTitle || !modalSubmitBtn) return;

                
                modalTitle.textContent = "تعديل المنتج";
                modalSubmitBtn.textContent = "تحديث المنتج";
                addProductForm.dataset.editingId = product.id; 

                
                document.getElementById('productName').value = product.name || '';
                document.getElementById('productPrice').value = product.price || 0;
                
                
                document.getElementById('productImageUrls').value = (product.imageUrls || []).join(', ');
                
                document.getElementById('productCategory').value = product.category || 'Other';
                document.getElementById('productDescription').value = product.description || '';
                
                
                const saleCheck = document.getElementById('isOnSale');
                const bestsellerCheck = document.getElementById('isBestSeller');
                saleCheck.checked = product.isOnSale || false;
                bestsellerCheck.checked = product.isBestSeller || false;

                
                if (product.isOnSale) {
                    originalPriceContainer.classList.remove('hidden');
                    document.getElementById('originalPrice').value = product.originalPrice || 0;
                } else {
                    originalPriceContainer.classList.add('hidden');
                    document.getElementById('originalPrice').value = '';
                }

                
                document.getElementById('productCompany').value = product.company || '';
                document.getElementById('productVolts').value = product.volts || '';
                document.getElementById('productLength').value = product.length || '';
                document.getElementById('productWarranty').value = product.warranty || '';
                document.getElementById('productMadeIn').value = product.madeIn || '';
                document.getElementById('productModel').value = product.model || '';
                
                
                modal.classList.remove('hidden');
            }


            
            function renderArticleCard(article) {
                const deleteButtonHTML = currentIsAdmin
                    ? `<button class="delete-article-btn p-1.5 sm:p-2 bg-red-600 text-white rounded-lg hover:bg-red-700" title="حذف المقالة" data-article-id="${article.id}">
                           <i data-lucide="trash-2" class="w-4 h-4"></i>
                       </button>`
                    : '';
                
                const editButtonHTML = currentIsAdmin
                    ? `<button class="edit-article-btn p-1.5 sm:p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700" title="تعديل المقالة" data-article-id="${article.id}">
                           <i data-lucide="edit-3" class="w-4 h-4"></i>
                       </button>`
                    : '';
                
                
                let previewText = 'اضغط لقراءة المزيد...';
                if (Array.isArray(article.content) && article.content.length > 0) {
                    
                    const firstBlock = article.content.find(b => b.body);
                    if (firstBlock) {
                        previewText = firstBlock.body.substring(0, 100) + '...';
                    } else if (article.content[0].title) {
                        
                        previewText = article.content[0].title;
                    }
                } else if (typeof article.content === 'string' && article.content) {
                    
                    previewText = (article.content.replace(/<[^>]+>/g, '').substring(0, 100) || 'اضغط لقراءة المزيد') + '...';
                }
                

                return `
                <div class="card-hover bg-white dark:bg-[#2c2f38] rounded-xl shadow-lg overflow-hidden flex flex-col">
                    <img class="w-full h-40 object-cover" src="${article.imageUrl}" onerror="this.src='https://placehold.co/400x250/eeeeee/777777?text=Image+Not+Found'" alt="${article.title}">
                    <div class="p-4 flex-grow flex flex-col">
                        <h2 class="text-lg font-semibold mb-2">${article.title}</h2>
                        <p class="text-gray-600 dark:text-gray-300 text-sm mb-4 flex-grow">
                            ${previewText}
                        </p>
                        <div class="flex items-center justify-between">
                            <a href="#blog/${article.shortId || article.id}" class="article-details-link font-medium text-[#ffcd00] hover:text-[#ffda33]" data-article-id="${article.id}">اقرأ المزيد &larr;</a>
                            <div class="flex gap-2">
                                ${editButtonHTML}
                                ${deleteButtonHTML}
                            </div>
                        </div>
                    </div>
                </div>
                `;
            }

            function renderArticles() {
                const blogGrid = document.getElementById('blog-grid');
                if (!blogGrid) return;

                if (allArticles.length === 0) {
                    blogGrid.innerHTML = '<p class="text-gray-500 dark:text-gray-400 col-span-1 md:col-span-2 lg:col-span-3 text-center">لم يتم العثور على مقالات. تحقق مرة أخرى لاحقاً!</p>';
                    return;
                }

                blogGrid.innerHTML = '';
                allArticles.forEach(article => {
                    blogGrid.innerHTML += renderArticleCard(article);
                });


                setupDeleteArticleButtons();
                setupEditArticleButtons();
                lucide.createIcons();
            }

            function setupArticleDetailsLinks() {
                document.querySelectorAll('.article-details-link').forEach(link => {
                    if (link.dataset.listenerAttached) return;
                    link.dataset.listenerAttached = 'true';
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const articleId = e.currentTarget.dataset.articleId;
                        showPage('blog-post', articleId);
                    });
                });
            }

            function setupDeleteArticleButtons() {
                document.querySelectorAll('.delete-article-btn').forEach(btn => {
                    if (btn.dataset.listenerAttached) return;
                    btn.dataset.listenerAttached = 'true';
                    btn.addEventListener('click', async (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        const articleId = e.currentTarget.dataset.articleId;
                        if (!articleId) return;
                        
                        await deleteArticle(articleId);
                    });
                });
            }

            async function deleteArticle(id) {
                try {
                    const articleRef = doc(db, "articles", id);
                    await deleteDoc(articleRef);
                    showToast("تم حذف المقالة بنجاح.");
                } catch (error) {
                    console.error("Error deleting article: ", error);
                    showToast("خطأ: لم نتمكن من حذف المقالة.");
                }
            }

            function setupEditArticleButtons() {
                document.querySelectorAll('.edit-article-btn').forEach(btn => {
                    if (btn.dataset.listenerAttached) return;
                    btn.dataset.listenerAttached = 'true';
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        const articleId = e.currentTarget.dataset.articleId;
                        if (!articleId) return;
                        const article = allArticles.find(a => a.id === articleId);
                        if (article) {
                            openEditArticleModal(article);
                        }
                    });
                });
            }

            function openEditArticleModal(article) {
                if (!articleModal || !addArticleForm || !articleModalTitle || !articleModalSubmitBtn) return;

                articleModalTitle.textContent = "تعديل المقالة";
                articleModalSubmitBtn.textContent = "تحديث المقالة";
                addArticleForm.dataset.editingId = article.id;

                document.getElementById('articleTitle').value = article.title || '';
                document.getElementById('articleImageUrl').value = article.imageUrl || '';
                
                
                const container = document.getElementById('article-paragraphs-container');
                if (container) {
                    container.innerHTML = '';
                }
                
                
                if (Array.isArray(article.content) && article.content.length > 0) {
                    article.content.forEach(block => {
                        const type = block.type || 'paragraph';
                        if (type === 'paragraph') {
                            createParagraphBlock(block.title, block.body);
                        } else if (type === 'gallery') {
                            createGalleryBlock(block.images);
                        }
                    });
                } else if (typeof article.content === 'string' && article.content) {
                    
                    
                    createParagraphBlock('', article.content);
                } else {
                    
                    createParagraphBlock();
                }
                reNumberParagraphBlocks();
                
                
                

                articleModal.classList.remove('hidden');
            }

            function renderArticleDetails(articleId) {
                const article = allArticles.find(a => a.shortId === articleId || a.id === articleId);
                if (!article) {
                    showPage('blog');
                    return;
                }

                const titleEl = document.getElementById('blog-post-title');
                const imageEl = document.getElementById('blog-post-image');
                const contentEl = document.getElementById('blog-post-content-wrapper');

                if (titleEl) titleEl.textContent = article.title;
                if (imageEl) {
                    imageEl.src = article.imageUrl;
                    imageEl.alt = article.title;
                }
                
                
                if (contentEl) {
                    let finalHtml = '';
                    let paragraphCounter = 1;
                    
                    
                    if (Array.isArray(article.content)) {
                        article.content.forEach((block) => {
                            const type = block.type || 'paragraph';

                            if (type === 'paragraph') {
                                if (block.title) {
                                    const safeTitle = escapeHTML(block.title);
                                    
                                    finalHtml += `<h2>${paragraphCounter}. ${safeTitle}</h2>\n`;
                                }
                                
                                if (block.body) {
                                    const lines = block.body.split('\n')
                                                        .map(line => line.trim())
                                                        .filter(line => line.length > 0);
                                    
                                    if (lines.length > 0) {
                                        finalHtml += '<ul>\n';
                                        lines.forEach(line => {
                                            finalHtml += `<li>${escapeHTML(line)}</li>\n`;
                                        });
                                        finalHtml += '</ul>\n';
                                    }
                                }
                                paragraphCounter++;
                            
                            } else if (type === 'gallery' && block.images && block.images.length > 0) {
                                
                                
                                finalHtml += '<div class="not-prose grid grid-cols-2 md:grid-cols-3 gap-2 my-4">\n';
                                block.images.forEach(url => {
                                    finalHtml += `
                                        <div>
                                            <img src="${escapeHTML(url)}" 
                                                 class="w-full h-auto object-cover rounded-md shadow-md aspect-square" 
                                                 onerror="this.src='https://placehold.co/400x400/eeeeee/777777?text=Image+Error'" 
                                                 alt="Gallery Image">
                                        </div>\n`;
                                });
                                finalHtml += '</div>\n';
                                
                            }
                        });
                    } else if (typeof article.content === 'string') {
                        
                        
                        finalHtml = article.content;
                    }
                    
                    contentEl.innerHTML = finalHtml || '<p>لا يوجد محتوى متاح.</p>';
                }
                
            }

            

            
            function setupProductDetailsLinks() {
                document.querySelectorAll('.product-details-link').forEach(btn => {
                    
                    if (btn.dataset.listenerAttached) return;
                    btn.dataset.listenerAttached = 'true';
                    
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        
                        const productId = e.currentTarget.dataset.productId;
                        
                        console.log('Details link clicked, Product ID:', productId); 
                        if (!productId) {
                            console.error("Product ID is missing from the button!");
                            return;
                        }
                        
                        showPage('details', productId);
                    });
                });
            }


            
            async function deleteProduct(id) {
                try {
                    const productRef = doc(db, "products", id);
                    await deleteDoc(productRef);
                    showToast("تم حذف المنتج بنجاح.");
                } catch (error) {
                    console.error("Error deleting product: ", error);
                    showToast("خطأ: لم نتمكن من حذف المنتج.");
                }
            }

            
            function renderProductDetails(productId) {
                
                console.log('renderProductDetails called for:', productId); 
                const product = allProducts.find(p => p.shortId === productId || p.id === productId);
                
                if (!product) {
                    console.error("Product not found in allProducts array:", productId);
                    showPage('products'); 
                    return;
                }

                
                console.log('Product found:', product); 

                
                const placeholder = 'https://placehold.co/150x150/eeeeee/777777?text=...';
                const mainImgEl = document.getElementById('main-product-image');
                const thumbnailContainer = document.getElementById('details-thumbnail-container');

                
                thumbnailContainer.innerHTML = '';

                
                const imageUrls = (product.imageUrls && product.imageUrls.length > 0) 
                                    ? product.imageUrls 
                                    : [product.imageUrl || placeholder];
                
                
                currentGalleryImages = imageUrls;
                currentGalleryIndex = 0;
                
                
                mainImgEl.src = imageUrls[0];

                
                imageUrls.forEach((url, index) => {
                    const img = document.createElement('img');
                    img.src = url;
                    img.alt = `Thumbnail ${index + 1}`;
                    img.onerror = function() { this.src = placeholder; };
                    img.className = "cursor-pointer rounded-md border-2 hover:border-[#ffcd00] transition-all duration-200 object-cover w-20 h-20 md:w-full md:h-auto md:aspect-square";
                    
                    
                    if (index === 0) {
                        img.classList.add('border-[#ffcd00]');
                        img.classList.remove('border-transparent');
                    } else {
                        img.classList.add('border-transparent');
                    }

                    
                    img.addEventListener('click', () => {
                        
                        updateGalleryView(index);
                    });
                    
                    thumbnailContainer.appendChild(img);
                });

                
                const prevBtn = document.getElementById('gallery-prev-btn');
                const nextBtn = document.getElementById('gallery-next-btn');
                
                
                const newPrevBtn = prevBtn.cloneNode(true);
                prevBtn.parentNode.replaceChild(newPrevBtn, prevBtn);
                
                const newNextBtn = nextBtn.cloneNode(true);
                nextBtn.parentNode.replaceChild(newNextBtn, nextBtn);

                newPrevBtn.addEventListener('click', () => {
                    updateGalleryView(currentGalleryIndex - 1);
                });
                
                newNextBtn.addEventListener('click', () => {
                    updateGalleryView(currentGalleryIndex + 1);
                });
                
                const companyEl = document.getElementById('details-product-company');
                if (companyEl) {
                    if (product.company && product.company.trim() !== '') {
                        companyEl.textContent = product.company;
                        companyEl.classList.remove('hidden');
                    } else {
                        companyEl.textContent = '';
                        companyEl.classList.add('hidden');
                    }
                }

                document.getElementById('details-product-name').textContent = product.name;
                
                const detailsRatingEl = document.getElementById('details-star-rating');
                if (detailsRatingEl) {
                    detailsRatingEl.innerHTML = generateStarRating();
                }

                document.getElementById('details-product-description').textContent = product.description || "لا يوجد وصف متاح لهذا المنتج.";

                
                const priceEl = document.getElementById('details-product-price');
                
                priceEl.classList.add('bg-gray-100', 'dark:bg-gray-700', 'p-4', 'rounded-lg', 'border', 'border-gray-200', 'dark:border-gray-600');

                if (product.isOnSale && product.originalPrice && product.originalPrice > product.price) {
                    const discountAmount = product.originalPrice - product.price;
                    const discountPercent = Math.round((discountAmount / product.originalPrice) * 100);
                    priceEl.innerHTML = `
                        <div class="flex items-baseline gap-3">
                            <span class="text-3xl lg:text-4xl font-bold text-[#ffcd00]">${product.price.toFixed(2)} EGP</span>
                            <span class="text-lg lg:text-xl text-gray-500 line-through">${product.originalPrice.toFixed(2)} EGP</span>
                        </div>
                        <div class="text-sm font-semibold text-red-500 mt-2">
                            !وفر ${discountAmount.toFixed(2)} EGP (خصم ${discountPercent}%)
                        </div>
                    `;
                } else {
                    priceEl.innerHTML = `
                        <div class="flex items-baseline gap-3">
                            <span class="text-3xl lg:text-4xl font-bold text-gray-900 dark:text-white">${product.price.toFixed(2)} EGP</span>
                        </div>
                    `;
                }

                
                
                const whatsappLink = document.getElementById('details-whatsapp-link');
                if (whatsappLink) {
                    const storePhone = "201146641942";
                    const productName = product.name;
                    
                    const message = `مرحباً متجر مكة،\n\nأود الاستفسار/الطلب بخصوص هذا المنتج:\n*${productName}*\n\nهل يمكنني معرفة المزيد من التفاصيل أو إتمام الطلب؟\nشكراً لكم.`;
                    const encodedMessage = encodeURIComponent(message);
                    whatsappLink.href = `https://wa.me/${storePhone}?text=${encodedMessage}`;
                }
                

                
                const cartWrapper = document.getElementById('details-add-to-cart-wrapper');
                cartWrapper.dataset.productId = product.id;
                cartWrapper.dataset.productName = product.name;
                cartWrapper.dataset.productPrice = product.price;
                cartWrapper.dataset.productImage = imageUrls[0]; 
                
                
                
                const detailBtn = cartWrapper.querySelector('.add-to-cart-btn');
                if (detailBtn) {
                    detailBtn.dataset.listenerAttached = 'false'; 
                    setupAddToCartButtons(); 
                }
                
                
                const quantityInput = document.getElementById('details-quantity-input');
                if (quantityInput) {
                    quantityInput.value = '1';
                }
                
                
                
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    const isSpecs = btn.dataset.tab === 'specs';
                    btn.classList.toggle('active-tab', isSpecs);
                    btn.classList.toggle('text-[#ffcd00]', isSpecs);
                    btn.classList.toggle('border-[#ffcd00]', isSpecs);
                    btn.classList.toggle('text-gray-500', !isSpecs);
                });
                document.querySelectorAll('.tab-content').forEach(content => {
                    const isSpecs = content.id === 'tab-content-specs';
                    content.classList.toggle('hidden', !isSpecs);
                });
                
                

                const specsContainer = document.getElementById('specs-list-container');
                if (specsContainer) {
                    specsContainer.innerHTML = ''; 

                 
                    const specs = [
                        { label: 'الشركة', value: product.company },
                        { label: 'الجهد', value: product.volts },
                        { label: 'الطول', value: product.length ? `${product.length} meters` : undefined },
                        { label: 'الضمان', value: product.warranty },
                        { label: 'صنع في', value: product.madeIn },
                        { label: 'رقم الموديل', value: product.model }
                    ];

                    let specsAdded = 0;

                    
                    specs.forEach(spec => {
                       
                        if (spec.value && String(spec.value).trim() !== '') {
                            const li = document.createElement('li');
                            li.className = "grid grid-cols-1 sm:grid-cols-2 sm:gap-4 pb-2 border-b border-gray-200 dark:border-gray-700";
                            li.innerHTML = `
                                <span class="font-medium text-gray-800 dark:text-gray-100">${spec.label}:</span>
                                <span class="sm:text-left">${spec.value}</span>
                            `;
                            specsContainer.appendChild(li);
                            specsAdded++;
                        }
                    });

                   
                    if (specsAdded === 0) {
                        specsContainer.innerHTML = '<p class="text-gray-500">لا توجد مواصفات إضافية متاحة لهذا المنتج.</p>';
                    } else {
                       
                        if (specsContainer.lastChild) {
                            specsContainer.lastChild.classList.remove('border-b', 'pb-2');
                        }
                    }
                }


            }


            async function fetchAiSuggestions(productId) {
                const loadingElDesktop = document.getElementById('ai-suggestions-loading-desktop');
                const gridElDesktop = document.getElementById('ai-suggestions-grid-desktop');
                const loadingElMobile = document.getElementById('ai-suggestions-loading-mobile');
                const gridElMobile = document.getElementById('ai-suggestions-grid-mobile');
                
              
                if (loadingElDesktop) loadingElDesktop.classList.remove('hidden');
                if (gridElDesktop) gridElDesktop.innerHTML = ''; 
                if (loadingElMobile) loadingElMobile.classList.remove('hidden');
                if (gridElMobile) gridElMobile.innerHTML = ''; 

                try {
                    const currentProduct = allProducts.find(p => p.shortId === productId || p.id === productId);
                    if (!currentProduct) {
                   
                        throw new Error("Current product not found for suggestions.");
                    }

                    const currentCategory = currentProduct.category;
                    const maxSuggestions = 3;
                    let suggestions = [];

        
                    const categoryProducts = allProducts.filter(p => 
                        p.category === currentCategory && (p.shortId !== productId && p.id !== productId)
                    );

                  
                    let shuffledCategory = [...categoryProducts];
                    for (let i = shuffledCategory.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffledCategory[i], shuffledCategory[j]] = [shuffledCategory[j], shuffledCategory[i]];
                    }
                    
                    suggestions = shuffledCategory.slice(0, maxSuggestions);

       
                    if (suggestions.length < maxSuggestions) {
                        const otherProducts = allProducts.filter(p => 
                            p.category !== currentCategory && (p.shortId !== productId && p.id !== productId)
                        );

         
                        let shuffledOthers = [...otherProducts];
                        for (let i = shuffledOthers.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [shuffledOthers[i], shuffledOthers[j]] = [shuffledOthers[j], shuffledOthers[i]];
                        }
                        
                        const needed = maxSuggestions - suggestions.length;
                        suggestions = suggestions.concat(shuffledOthers.slice(0, needed));
                    }
                    
                    
                    let suggestionsHtml = ''; 
                    if (suggestions.length === 0) {
                        
                        suggestionsHtml = `<p class="text-gray-500 dark:text-gray-400 col-span-2 sm:col-span-3 text-center">لا توجد منتجات أخرى لاقتراحها.</p>`;
                    } else {
                        
                        suggestions.forEach(product => {
                            if (product) {
                                
                                suggestionsHtml += renderProductCard(product);
                            }
                        });
                    }
                    
                  
                    if (gridElDesktop) gridElDesktop.innerHTML = suggestionsHtml;
                    if (gridElMobile) gridElMobile.innerHTML = suggestionsHtml;
                    
                    
            

                } catch (error) {
                    console.error("Error fetching suggestions:", error);
                 
                    const otherProducts = allProducts.filter(p => p.shortId !== productId && p.id !== productId);
                    let shuffled = [...otherProducts];
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    const randomSuggestions = shuffled.slice(0, 3);
                    
                    let fallbackHtml = '';
                    if (randomSuggestions.length > 0) {
                         randomSuggestions.forEach(product => {
                            if (product) {
                              
                                fallbackHtml += renderProductCard(product);
                            }
                        });
                     
                    } else {
                        fallbackHtml = `<p class="text-red-500 col-span-2 sm:col-span-3 text-center">لا توجد اقتراحات حالياً.</p>`;
                    }
                    
                    if (gridElDesktop) gridElDesktop.innerHTML = fallbackHtml;
                    if (gridElMobile) gridElMobile.innerHTML = fallbackHtml;

                } finally {
                   
                    if (loadingElDesktop) loadingElDesktop.classList.add('hidden');
                    if (loadingElMobile) loadingElMobile.classList.add('hidden');
                    
                   
                    setupAddToCartButtons();
                    setupDeleteProductButtons();
                    setupEditProductButtons();
             
                    lucide.createIcons();
                }
            }

            function loadProducts() {
                const productsRef = collection(db, "products");
                const q = query(productsRef);

                onSnapshot(q, (querySnapshot) => {
                 
                    allProducts = []; 
                    querySnapshot.forEach((doc) => {
                        allProducts.push({ id: doc.id, ...doc.data() });
                    });
                    console.log("Products loaded from Firestore:", allProducts.length);
                    
                    renderAllProductViews();
                }, (error) => {
                    console.error("Error fetching products: ", error);
                    showToast("خطأ أثناء جلب المنتجات.");
                });
            }
            
            document.getElementById('product-search-input').addEventListener('input', () => {
                preFilterType = 'all';
                renderAllProductViews();
            });

            const categoryFilterForPlaceholder = document.getElementById('product-category-filter');
            const searchInputForPlaceholder = document.getElementById('product-search-input');

            function updateSearchPlaceholder() {
                if (!categoryFilterForPlaceholder || !searchInputForPlaceholder) return;
                const selectedOption = categoryFilterForPlaceholder.options[categoryFilterForPlaceholder.selectedIndex];
                const selectedText = selectedOption.value === 'all' ? 'جميع الأقسام' : selectedOption.text;
                searchInputForPlaceholder.placeholder = `ابحث في ${selectedText}...`;
            }

            if (categoryFilterForPlaceholder) {
                categoryFilterForPlaceholder.addEventListener('change', () => {
                    preFilterType = 'all';
                    updateSearchPlaceholder();
                    renderAllProductViews();
                });
            }
            
            document.getElementById('product-sort-filter').addEventListener('change', () => {
                preFilterType = 'all';
                renderAllProductViews();
            });

            function loadArticles() {
                const articlesRef = collection(db, "articles");
                const q = query(articlesRef);

                onSnapshot(q, (querySnapshot) => {
                    allArticles = [];
                    querySnapshot.forEach((doc) => {
                        allArticles.push({ id: doc.id, ...doc.data() });
                    });
                    console.log("Articles loaded from Firestore:", allArticles.length);
                    renderArticles();
                }, (error) => {
                    console.error("Error fetching articles: ", error);
                    showToast("خطأ أثناء جلب المقالات.");
                });
            }

           
            function loadSiteConfig() {
               
                const bannerConfigRef = doc(db, "config", "main_banners");
                
                onSnapshot(bannerConfigRef, (docSnap) => {
                    const lightBannerImg = document.getElementById('special-offer-banner-light')?.querySelector('img');
                    const darkBannerImg = document.getElementById('special-offer-banner-dark')?.querySelector('img');
                    const adminLightUrlInput = document.getElementById('admin-light-banner-url');
                    const adminDarkUrlInput = document.getElementById('admin-dark-banner-url');

                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        
                     
                        if (lightBannerImg && data.lightUrl) {
                            lightBannerImg.src = data.lightUrl;
                        }
                        if (darkBannerImg && data.darkUrl) {
                            darkBannerImg.src = data.darkUrl;
                        }
                        
                       
                        if (adminLightUrlInput) {
                            adminLightUrlInput.value = data.lightUrl || '';
                        }
                        if (adminDarkUrlInput) {
                            adminDarkUrlInput.value = data.darkUrl || '';
                        }
                        
                    } else {
                        console.log("No banner config document found!");
                    }
                }, (error) => {
                    console.error("Error fetching banner config: ", error);
                    showToast("خطأ في تحميل إعدادات البانر.");
                });

               
                const homepageConfigRef = doc(db, "config", "homepage");
                onSnapshot(homepageConfigRef, (docSnap) => {
                    const videoEl = document.getElementById('hero-video');
                    const videoSourceEl = document.getElementById('hero-video-source');
                    const adminVideoUrlInput = document.getElementById('admin-video-url');

                    if (docSnap.exists()) {
                        const data = docSnap.data();

                 
                        if (videoSourceEl && data.videoUrl) {
                            videoSourceEl.src = data.videoUrl;
                            if (videoEl) {
                                videoEl.load(); 
                            }
                        }

                      
                        if (adminVideoUrlInput) {
                            adminVideoUrlInput.value = data.videoUrl || '';
                        }
                    } else {
                        console.log("No homepage config document found!");
                    }
                }, (error) => {
                    console.error("Error fetching homepage config: ", error);
                    showToast("خطأ في تحميل إعدادات الفيديو.");
                });
            }
      


            const closeMobileMenu = () => {
                const mobileMenu = document.getElementById('mobile-menu');
                const openIcon = document.getElementById('mobile-menu-open-icon');
                const closeIcon = document.getElementById('mobile-menu-close-icon');
                const mobileMenuButton = document.getElementById('mobile-menu-button');

                if (mobileMenu && openIcon && closeIcon && mobileMenuButton) {
                    mobileMenu.classList.add('hidden');
                    openIcon.classList.remove('hidden');
                    closeIcon.classList.add('hidden');
                    mobileMenuButton.setAttribute('aria-expanded', 'false');
                }
            };

            const showPage = (pageId, itemId = null) => {
                
                console.log('showPage called with pageId:', pageId, 'and itemId:', itemId); 
                
                
                const allPages = document.querySelectorAll('.page-section');
                allPages.forEach(page => {
                    page.classList.remove('active');
                });
                
                const targetPage = document.getElementById(`page-${pageId}`);
                if (targetPage) {
                    targetPage.classList.add('active');
                    if (pageId === 'cart') {
                        renderCartPage();
                    } else if (pageId === 'details' && itemId) {
                        renderProductDetails(itemId);
                        fetchAiSuggestions(itemId); 
                    } else if (pageId === 'blog-post' && itemId) {
                        renderArticleDetails(itemId);
                    }
                } else {
                    const homePage = document.getElementById('page-home');
                    if (homePage) {
                        homePage.classList.add('active');
                    }
                }
                
                const lightBanner = document.getElementById('special-offer-banner-light');
                const darkBanner = document.getElementById('special-offer-banner-dark');
                
                if (lightBanner && darkBanner) {
                 

                    if (pageId === 'home') {
                        
                        lightBanner.style.transform = 'translateY(0)';
                        darkBanner.style.transform = 'translateY(0)';
                    } else {
                        
                        lightBanner.style.transform = 'translateY(-100%)';
                        darkBanner.style.transform = 'translateY(-100%)';
                    }
                }
           

                window.scrollTo(0, 0);
                closeMobileMenu();
                
                lucide.createIcons();
            };

            try {
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');
                const openIcon = document.getElementById('mobile-menu-open-icon');
                const closeIcon = document.getElementById('mobile-menu-close-icon');

                if (mobileMenuButton) {
                    mobileMenuButton.addEventListener('click', () => {
                        const isOpen = mobileMenu.classList.toggle('hidden');
                        openIcon.classList.toggle('hidden', !isOpen);
                        closeIcon.classList.toggle('hidden', isOpen);
                        mobileMenuButton.setAttribute('aria-expanded', !isOpen);
                    });
                }
               
                
                
                const allPages = document.querySelectorAll('.page-section');
                const allNavLinks = document.querySelectorAll('.nav-link, .logo-link');
                const allMobileNavLinks = document.querySelectorAll('.mobile-nav-link');

                allNavLinks.forEach(link => {
                    
                    if (link.dataset.navListenerAttached) return; 
                    link.dataset.navListenerAttached = 'true';

                   
                    const categoryFilter = link.dataset.categoryFilter;

                    if (categoryFilter) {
                        link.addEventListener('click', (e) => {
                            e.preventDefault(); 
                            const pageId = e.currentTarget.dataset.page;
                            
                            const categoryDropdown = document.getElementById('product-category-filter');
                            if (categoryDropdown) {
                                categoryDropdown.value = categoryFilter;
                               
                                document.getElementById('product-search-input').value = '';
                                document.getElementById('product-sort-filter').value = 'default';
                                preFilterType = 'all'; 
                                updateSearchPlaceholder(); 
                            }
                            window.location.hash = `#${pageId}`; 
                        });
                    }
                    
                });
                
                allMobileNavLinks.forEach(link => {
         
                    if (link.dataset.navListenerAttached) return;
                    link.dataset.navListenerAttached = 'true';

                  
                });

                const lightBanner = document.getElementById('special-offer-banner-light');
                const darkBanner = document.getElementById('special-offer-banner-dark');
                
                if (lightBanner && darkBanner) {
                  
                    let pageIsSettling = true; 
                    
                  
                    const checkBannerState = () => {
               
                
                        const isHomePage = document.getElementById('page-home').classList.contains('active');
                        if (!isHomePage) {
                       
                            return; 
                        }
                   

                        const currentScrollY = window.scrollY;

                        if (currentScrollY < 10) { 
                            
                            lightBanner.style.transform = 'translateY(0)';
                            darkBanner.style.transform = 'translateY(0)';
                        } else {
                            
                            if (!pageIsSettling) {
                                lightBanner.style.transform = 'translateY(-100%)';
                                darkBanner.style.transform = 'translateY(-100%)';
                            }
                        }
                    };
                    
                
                    window.addEventListener('scroll', checkBannerState, { passive: true });

              
                    lightBanner.style.transform = 'translateY(0)';
                    darkBanner.style.transform = 'translateY(0)';
                    
                  
                    setTimeout(() => {
                        pageIsSettling = false;
                      
                        checkBannerState();
                    }, 500); 
                }
             
                const adminForm = document.getElementById('admin-settings-form');
                if (adminForm) {
                    adminForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        
                      
                        if (!currentIsAdmin) {
                            showToast("ليس لديك صلاحية.");
                            return;
                        }

                        const saveBtn = document.getElementById('save-admin-settings-btn');
                        const originalBtnText = saveBtn.innerHTML;
                        saveBtn.disabled = true;
                        saveBtn.innerHTML = '...جاري الحفظ';

                        try {
                          
                            const lightUrl = document.getElementById('admin-light-banner-url').value;
                            const darkUrl = document.getElementById('admin-dark-banner-url').value;
                            const bannerConfigRef = doc(db, "config", "main_banners");
                            await setDoc(bannerConfigRef, { lightUrl, darkUrl }, { merge: true });

                        
                            const videoUrl = document.getElementById('admin-video-url').value;
                            const homepageConfigRef = doc(db, "config", "homepage");
                            await setDoc(homepageConfigRef, { videoUrl }, { merge: true });

                            showToast("تم حفظ الإعدادات بنجاح!");
                        } catch (error) {
                            console.error("Error saving config: ", error);
                            showToast("خطأ أثناء حفظ الإعدادات.");
                        } finally {
                            saveBtn.disabled = false;
                            saveBtn.innerHTML = originalBtnText;
                        }
                    });
                }
               
                
                
                document.querySelectorAll('.see-all-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        preFilterType = e.currentTarget.dataset.filterType;
                        
                        
                        document.getElementById('product-search-input').value = '';
                        document.getElementById('product-category-filter').value = 'all';
                        document.getElementById('product-sort-filter').value = 'default';
                        
                        
                    
                        window.location.hash = '#products';
                    });
                });

                const contactForm = document.getElementById('contact-form');
                const successMessage = document.getElementById('form-success-message');
                if(contactForm) {
                    contactForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        if(successMessage) successMessage.classList.remove('hidden');
                        contactForm.reset();
                        setTimeout(() => {
                            if(successMessage) successMessage.classList.add('hidden');
                        }, 3000);
                    });
                }
                
                const checkoutBtn = document.getElementById('whatsapp-checkout-btn');
                if (checkoutBtn) {
                    checkoutBtn.addEventListener('click', generateWhatsAppInvoice);
                }
                
                lucide.createIcons();

                
                const tabButtons = document.querySelectorAll('.tab-btn');
                const tabContents = document.querySelectorAll('.tab-content');

                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const tabId = button.dataset.tab;

                        
                        tabButtons.forEach(btn => {
                            btn.classList.remove('active-tab', 'text-[#ffcd00]', 'border-b-2', 'border-[#ffcd00]');
                            btn.classList.add('text-gray-500');
                        });
                        button.classList.add('active-tab', 'text-[#ffcd00]', 'border-b-2', 'border-[#ffcd00]');
                        button.classList.remove('text-gray-500');

                        
                        tabContents.forEach(content => {
                            if (content.id === `tab-content-${tabId}`) {
                                content.classList.remove('hidden');
                            } else {
                                content.classList.add('hidden');
                            }
                        });
                    });
                });

                
                const termsModal = document.getElementById('terms-modal');
                const openTermsBtn = document.getElementById('open-terms-modal-btn');
                const closeTermsBtn = document.getElementById('close-terms-modal-btn');

                if (openTermsBtn && termsModal) {
                    openTermsBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        termsModal.classList.remove('hidden');
                        lucide.createIcons(); 
                    });
                }
                if (closeTermsBtn && termsModal) {
                    closeTermsBtn.addEventListener('click', () => {
                        termsModal.classList.add('hidden');
                    });
                }

                
                const helpModal = document.getElementById('gemini-help-modal');
                const openHelpBtn = document.getElementById('open-help-modal-btn');
                const closeHelpBtn = document.getElementById('close-help-modal-btn');
                const helpForm = document.getElementById('help-form');
                const helpInput = document.getElementById('help-input');
                const chatHistoryEl = document.getElementById('chat-history');
                const loadingIndicator = document.getElementById('loading-indicator');
                const helpPanel = document.getElementById('gemini-help-panel');
                const clearChatBtn = document.getElementById('clear-chat-btn');

                if (openHelpBtn && helpModal && helpPanel) {
                    openHelpBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        helpModal.classList.remove('hidden');
                        helpModal.offsetHeight;
                        helpModal.dataset.state = "open";
                        
                      
                        const chatHistoryEl = document.getElementById('chat-history');
                        if (chatHistoryEl && chatHistoryEl.querySelectorAll('.chat-message').length === 1) {
                            renderSuggestionChips(defaultSuggestions);
                        }

                        lucide.createIcons(); 
                    });
                }
                
                if (closeHelpBtn && helpModal && helpPanel) {
                    
                    const closeAiModal = () => {
                        helpModal.dataset.state = "closed";
                        
                        
                        helpPanel.addEventListener('transitionend', () => {
                            if (helpModal.dataset.state === "closed") {
                                helpModal.classList.add('hidden');
                            }
                        }, { once: true });
                    };

                    closeHelpBtn.addEventListener('click', closeAiModal);
                    
                    
                    helpModal.addEventListener('click', (e) => {
                        if (e.target === helpModal) {
                            closeAiModal();
                        }
                    });
                }

                
                if (clearChatBtn) {
                    clearChatBtn.addEventListener('click', () => {
                        aiChatHistory = [];
                        
                        chatHistoryEl.innerHTML = `
                            <div class="model-message self-start">
                                أهلاً بك في متجر مكة! كيف يمكنني مساعدتك اليوم؟
                            </div>
                        `;
                  
                        renderSuggestionChips(defaultSuggestions);
                        showLoading(false);
                    });
                }

                if (helpForm) {
                    helpForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const userQuery = helpInput.value.trim();
                        if (!userQuery) return;

                        
                        const suggestionsContainer = document.querySelector('.chat-suggestions-container');
                        if (suggestionsContainer) {
                            suggestionsContainer.remove();
                        }

                        helpInput.value = '';
                        addMessageToHistory('user', userQuery);
                        aiChatHistory.push({ role: "user", parts: [{ text: userQuery }] });
                        showLoading(true);
                        renderSuggestionChips([]);

                        try {
                            
                            
                            const productContext = allProducts.map(p => {
                                return `- اسم المنتج: ${p.name}\n  الوصف: ${p.description || 'لا يوجد وصف'}\n  السعر: ${p.price} EGP`;
                            }).join('\n\n');

                            
                            const response = await callGemini(productContext);

                            
                            const rawText = response;
                            let cleanText = rawText;
                            let recommendations = [];

                            
                            const jsonRegex = /<JSON_RECOMMEND>(.*?)<\/JSON_RECOMMEND>/s;
                            const match = rawText.match(jsonRegex);

                            if (match && match[1]) {
                                
                                cleanText = rawText.replace(jsonRegex, '').trim();
                                try {
                                    const parsedJson = JSON.parse(match[1]);
                                    if (parsedJson.recommendations) {
                                        recommendations = parsedJson.recommendations;
                                    }
                                } catch (err) {
                                    console.error("Failed to parse AI recommendations JSON:", err);
                                    
                                }
                            }
                            

                            
                            if (cleanText) {
                                addMessageToHistory('model', cleanText);
                                aiChatHistory.push({ role: "model", parts: [{ text: cleanText }] });
                            }

                            
                            if (recommendations.length > 0) {
                                addRecommendationsToHistory(recommendations);
                            } else {
                            
                            }
                            

                        } catch (error) {
                            console.error("Gemini API Error:", error);
                            addMessageToHistory('model', "عذراً، نواجه مشكلة في الاتصال بالمساعد الآن. يرجى المحاولة مرة أخرى.");
                        } finally {
                            showLoading(false);
                        }
                    });
                }

                function addMessageToHistory(role, text) {
                    const messageDiv = document.createElement('div');
                    messageDiv.classList.add(role === 'user' ? 'user-message' : 'model-message');
                    messageDiv.textContent = text;
                    chatHistoryEl.appendChild(messageDiv);
                    
                    chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
                }

                function showLoading(isLoading) {
                    if (isLoading) {
                        loadingIndicator.classList.remove('hidden');
                        chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight; 
                    } else {
                        loadingIndicator.classList.add('hidden');
                    }
                }

                
                function renderSuggestionChips(suggestions) {
      
                    const chatHistoryEl = document.getElementById('chat-history');
                    if (!chatHistoryEl || suggestions.length === 0) return;

                 
                    const oldSuggestions = chatHistoryEl.querySelector('.chat-suggestions-container');
                    if (oldSuggestions) {
                        oldSuggestions.remove();
                    }

                    const container = document.createElement('div');
                    container.className = 'chat-suggestions-container';

                    suggestions.forEach(suggestion => {
                        const chip = document.createElement('div');
                        chip.className = 'suggestion-chip';
                        chip.textContent = suggestion;
                        
                        
                        chip.addEventListener('click', () => {
                            const helpInput = document.getElementById('help-input');
                            const helpForm = document.getElementById('help-form');
                            if(helpInput && helpForm) {
                                helpInput.value = suggestion;
                                // Trigger the form submit event
                                helpForm.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));
                            }
                        });
                        
                        container.appendChild(chip);
                    });

                    chatHistoryEl.appendChild(container);
                    chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
                }
                
                function addRecommendationsToHistory(productNames) {
                    const container = document.createElement('div');
                    container.className = 'chat-recommendation-container';

                    let foundProducts = 0;

                    productNames.forEach(name => {
                        
                        const product = allProducts.find(p => p.name.toLowerCase().includes(name.toLowerCase()));
                        
                        if (product) {
                            foundProducts++;
                            const mainImg = (product.imageUrls && product.imageUrls[0]) ? product.imageUrls[0] : (product.imageUrl || 'https://placehold.co/400x400/eeeeee/777777?text=Image+Error');
                            
                            
                            
                            const card = document.createElement('div');
                            card.className = 'chat-product-card';
                            card.innerHTML = `
                                <img src="${mainImg}" alt="${product.name}" onerror="this.src='https://placehold.co/160x96/eeeeee/777777?text=Image+Error'">
                                <div class="chat-product-card-content">
                                    <h5 class="chat-product-card-name" title="${product.name}">${product.name}</h5>
                                    <p class="chat-product-card-price">${product.price.toFixed(2)} EGP</p>
                                    <a href="#product/${product.shortId || product.id}" class="chat-product-card-btn" data-product-id="${product.id}">
                                        عرض التفاصيل
                                    </a>
                                </div>
                            `;
                            
                            
                            card.querySelector('.chat-product-card-btn').addEventListener('click', (e) => {
                                // e.preventDefault(); // Let the hash change
                                const productId = e.currentTarget.dataset.productId;
                                
                                
                                helpModal.dataset.state = "closed";
                                helpModal.classList.add('hidden');
                                
                                
                                // showPage('details', productId); // Router will handle this
                            });

                            container.appendChild(card);
                        }
                    });

                    if (foundProducts > 0) {
                        chatHistoryEl.appendChild(container);
                        chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
                    }
                }

                
                async function fetchWithBackoff(url, options, retries = 5, delay = 1000) {
                    for (let i = 0; i < retries; i++) {
                        try {
                            const response = await fetch(url, options);
                            if (response.ok) {
                                return response.json();
                            }
                            
                            if (response.status >= 400 && response.status < 500 && response.status !== 429) {
                                console.error("Client error:", response.status);
                                return response.json(); 
                            }
                            
                        } catch (error) {
                            
                            console.warn("Network error, retrying...");
                        }
                        
                        const jitter = Math.random() * 500; 
                        await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i) + jitter));
                    }
                    
                    throw new Error("API call failed after all retries.");
                }

                
                

                
                async function callGemini(productContext) {
                    const apiKey = "AIzaSyBq-hUXxsXIEvmxspu0eH4WCuMg-gJNw98"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                    
                    const systemPrompt = `أنت "مساعد مكة"، المساعد الذكي لمتجر "متجر مكة للأدوات الكهربائية".
مهمتك الأساسية هي مساعدة العملاء في العثور على المنتجات وتقديم النصح.

**تعليمات صارمة:**

1.  **التركيز على المنتجات:** أولويتك هي الإجابة على أسئلة العملاء باستخدام 'قائمة المنتجات المتاحة' المرفقة. كن دقيقاً وساعدهم في العثور على ما يبحثون عنه.
2.  **الأسئلة العامة:** إذا سأل العميل سؤالاً عاماً عن الكهرباء، أو نصائح التركيب، أو أي شيء غير متوفر في قائمة المنتجات (مثل 'كيف أركب مفتاح كهرباء؟')، استخدم أداة 'Google Search' لتقديم إجابة مفيدة.
3.  **كن خبيراً:** تصرف كخبير ودود. لا تخترع منتجات أو أسعار غير موجودة في القائمة.
4.  **اقتراح المنتجات (هام جداً):**
    * عندما تقتنع أن العميل يبحث عن منتجات معينة، قم باقتراحها.
    * **يجب** عليك إرفاق كتلة JSON خاصة في *نهاية* ردك بهذا التنسيق الدقيق. لا تضف أي نص بعد هذا الكود.
    * التنسيق:
        \`<JSON_RECOMMEND>\`
        \`{"recommendations": ["اسم المنتج الدقيق 1", "اسم المنتج الدقيق 2"]}\`
        \`</JSON_RECOMMEND>\`

**قائمة المنتجات المتاحة (للاستخدام الداخلي):**
${productContext}
`;

                    
                    const payload = {
                        
                        contents: aiChatHistory,
                        systemInstruction: {
                            parts: [{ text: systemPrompt }]
                        },
                        
                        tools: [
                            {
                                "google_search": {}
                            }
                        ]
                        
                    };

                    const result = await fetchWithBackoff(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (!text) {
                        
                        if (result.candidates?.[0]?.finishReason === 'SAFETY') {
                            console.warn("AI response blocked for safety.");
                            return "عذراً، لا أستطيع المساعدة في هذا الطلب تحديداً. هل يمكنني مساعدتك في شيء آخر يخص منتجاتنا؟";
                        }
                        console.error("No text in Gemini response:", result);
                        throw new Error(result.error?.message || "Invalid API response");
                    }
                    
                    try {
                        
                        return text; 
                    } catch (e) {
                        console.error("Failed to parse JSON response from AI:", e);
                        
                        return "عذراً، حدث خطأ فني. يرجى المحاولة مرة أخرى بعد قليل.";
                    }
                }
                


                function handleRouting() {
                    const hash = window.location.hash || '#home';
                    console.log("Routing to:", hash);

                    const allNavLinks = document.querySelectorAll('.nav-link, .logo-link');
                    const allMobileNavLinks = document.querySelectorAll('.mobile-nav-link');

                    let targetPageId = 'home'; // default
                    let targetItemId = null;
                    const simplePages = ['home', 'products', 'blog', 'contact', 'cart', 'admin', 'about'];

                    if (hash.startsWith('#product/')) {
                        targetPageId = 'details';
                        targetItemId = hash.substring('#product/'.length);
                    } else if (hash.startsWith('#blog/')) {
                        targetPageId = 'blog-post';
                        targetItemId = hash.substring('#blog/'.length);
                    } else {
                        const pageName = hash.substring(1);
                        if (simplePages.includes(pageName)) {
                            targetPageId = pageName;
                        } else {
                            targetPageId = 'home'; 
                        }
                    }
                    

                    showPage(targetPageId, targetItemId);

                    allNavLinks.forEach(link => {
                        link.classList.toggle('active', link.dataset.page === targetPageId);
                    });
                    
                    allMobileNavLinks.forEach(link => {
                        link.classList.toggle('active', link.dataset.page === targetPageId);
                    });
                }


                window.addEventListener('hashchange', handleRouting);


                handleRouting();


            } catch (error) {
                console.error('Error initializing app:', error);
                document.querySelector('main').innerHTML = '<p class="text-center text-red-500">Error loading website content.</p>';
            }</script>